!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.cql=e()}}(function(){var e;return function n(e,t,r){function i(a,u){if(!t[a]){if(!e[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=t[a]={exports:{}};e[a][0].call(l.exports,function(n){var t=e[a][1][n];return i(t?t:n)},l,l.exports,n,e,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,n,t){},{}],2:[function(n,t,r){!function(n,i){"object"==typeof r&&"undefined"!=typeof t?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(n.d3_time={})}(this,function(e){"use strict";function n(e,t,r,a){function u(n){return e(n=new Date(+n)),n}return u.floor=u,u.round=function(n){var r=new Date(+n),i=new Date(n-1);return e(r),e(i),t(i,1),i-n>n-r?r:i},u.ceil=function(n){return e(n=new Date(n-1)),t(n,1),n},u.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},u.range=function(n,r,i){var o=[];if(n=new Date(n-1),r=new Date(+r),i=null==i?1:Math.floor(i),!(r>n&&i>0))return o;for(t(n,1),e(n),r>n&&o.push(new Date(+n));t(n,i),e(n),r>n;)o.push(new Date(+n));return o},u.filter=function(r){return n(function(n){for(;e(n),!r(n);)n.setTime(n-1)},function(e,n){for(;--n>=0;)for(;t(e,1),!r(e););})},r&&(u.count=function(n,t){return i.setTime(+n),o.setTime(+t),e(i),e(o),Math.floor(r(i,o))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(a?function(n){return a(n)%e===0}:function(n){return u.count(0,n)%e===0}):u:null}),u}function t(e){return n(function(n){n.setHours(0,0,0,0),n.setDate(n.getDate()-(n.getDay()+7-e)%7)},function(e,n){e.setDate(e.getDate()+7*n)},function(e,n){return(n-e-6e4*(n.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return n(function(n){n.setUTCHours(0,0,0,0),n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7)},function(e,n){e.setUTCDate(e.getUTCDate()+7*n)},function(e,n){return(n-e)/6048e5})}var i=new Date,o=new Date,a=n(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});a.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?n(function(n){n.setTime(Math.floor(n/e)*e)},function(n,t){n.setTime(+n+t*e)},function(n,t){return(t-n)/e}):a:null};var u=n(function(e){e.setMilliseconds(0)},function(e,n){e.setTime(+e+1e3*n)},function(e,n){return(n-e)/1e3},function(e){return e.getSeconds()}),c=n(function(e){e.setSeconds(0,0)},function(e,n){e.setTime(+e+6e4*n)},function(e,n){return(n-e)/6e4},function(e){return e.getMinutes()}),s=n(function(e){e.setMinutes(0,0,0)},function(e,n){e.setTime(+e+36e5*n)},function(e,n){return(n-e)/36e5},function(e){return e.getHours()}),l=n(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-6e4*(n.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),p=t(0),f=t(1),E=t(2),d=t(3),y=t(4),h=t(5),T=t(6),g=n(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+12*(n.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),S=n(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),m=n(function(e){e.setUTCMilliseconds(0)},function(e,n){e.setTime(+e+1e3*n)},function(e,n){return(n-e)/1e3},function(e){return e.getUTCSeconds()}),A=n(function(e){e.setUTCSeconds(0,0)},function(e,n){e.setTime(+e+6e4*n)},function(e,n){return(n-e)/6e4},function(e){return e.getUTCMinutes()}),N=n(function(e){e.setUTCMinutes(0,0,0)},function(e,n){e.setTime(+e+36e5*n)},function(e,n){return(n-e)/36e5},function(e){return e.getUTCHours()}),v=n(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/864e5},function(e){return e.getUTCDate()-1}),O=r(0),C=r(1),I=r(2),R=r(3),P=r(4),M=r(5),L=r(6),D=n(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,n){e.setUTCMonth(e.getUTCMonth()+n)},function(e,n){return n.getUTCMonth()-e.getUTCMonth()+12*(n.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),U=n(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),_=a.range,b=u.range,k=c.range,w=s.range,x=l.range,F=p.range,B=f.range,Y=E.range,H=d.range,G=y.range,Q=h.range,X=T.range,q=p.range,j=g.range,V=S.range,$=a,W=_,z=m.range,K=A.range,Z=N.range,J=v.range,ee=O.range,ne=C.range,te=I.range,re=R.range,ie=P.range,oe=M.range,ae=L.range,ue=O.range,ce=D.range,se=U.range,le="0.1.1";e.version=le,e.milliseconds=_,e.seconds=b,e.minutes=k,e.hours=w,e.days=x,e.sundays=F,e.mondays=B,e.tuesdays=Y,e.wednesdays=H,e.thursdays=G,e.fridays=Q,e.saturdays=X,e.weeks=q,e.months=j,e.years=V,e.utcMillisecond=$,e.utcMilliseconds=W,e.utcSeconds=z,e.utcMinutes=K,e.utcHours=Z,e.utcDays=J,e.utcSundays=ee,e.utcMondays=ne,e.utcTuesdays=te,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=se,e.millisecond=a,e.second=u,e.minute=c,e.hour=s,e.day=l,e.sunday=p,e.monday=f,e.tuesday=E,e.wednesday=d,e.thursday=y,e.friday=h,e.saturday=T,e.week=p,e.month=g,e.year=S,e.utcSecond=m,e.utcMinute=A,e.utcHour=N,e.utcDay=v,e.utcSunday=O,e.utcMonday=C,e.utcTuesday=I,e.utcWednesday=R,e.utcThursday=P,e.utcFriday=M,e.utcSaturday=L,e.utcWeek=O,e.utcMonth=D,e.utcYear=U,e.interval=n})},{}],3:[function(e,n,t){function r(e){if(!e)throw Error("Missing binning options.");var n,t,r,u,c,s,l,p=e.maxbins||15,f=e.base||10,E=Math.log(f),d=e.div||[5,2],y=e.min,h=e.max,T=h-y;if(e.step)n=e.step;else if(e.steps)n=e.steps[Math.min(e.steps.length-1,i(e.steps,T/p,0,e.steps.length))];else{for(t=Math.ceil(Math.log(p)/E),r=e.minstep||0,n=Math.max(r,Math.pow(f,Math.round(Math.log(T)/E)-t));Math.ceil(T/n)>p;)n*=f;for(s=0;s<d.length;++s)c=n/d[s],c>=r&&p>=T/c&&(n=c)}return c=Math.log(n),u=c>=0?0:~~(-c/E)+1,l=Math.pow(f,-u-1),y=Math.min(y,Math.floor(y/n+l)*n),h=Math.ceil(h/n)*n,{start:y,stop:h,step:n,unit:{precision:u},value:o,index:a}}function i(e,n,t,r){for(;r>t;){var i=t+r>>>1;s.cmp(e[i],n)<0?t=i+1:r=i}return t}function o(e){return this.step*Math.floor(e/this.step+p)}function a(e){return Math.floor((e-this.start)/this.step+p)}function u(e){return this.unit.date(o.call(this,e))}function c(e){return a.call(this,this.unit.unit(e))}var s=e("../util"),l=e("../time"),p=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var n=e.utc?l.utc:l,t=e.min,i=e.max,o=e.maxbins||20,a=e.minbins||4,s=+i-+t,p=e.unit?n[e.unit]:n.find(s,a,o),f=r({min:null!=p.min?p.min:p.unit(t),max:null!=p.max?p.max:p.unit(i),maxbins:o,minstep:p.minstep,steps:p.step});return f.unit=p,f.index=c,e.raw||(f.value=u),f},n.exports=r},{"../time":7,"../util":8}],4:[function(e,n,t){var r=e("./util"),i=n.exports;i.repeat=function(e,n){var t,r=Array(n);for(t=0;n>t;++t)r[t]=e;return r},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,n,t){if(arguments.length<3&&(t=1,arguments.length<2&&(n=e,e=0)),(n-e)/t==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(0>t)for(;(r=e+t*++o)>n;)i.push(r);else for(;(r=e+t*++o)<n;)i.push(r);return i},i.random={},i.random.uniform=function(e,n){void 0===n&&(n=void 0===e?1:e,e=0);var t=n-e,r=function(){return e+t*Math.random()};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r>=e&&n>=r?1/t:0},r.cdf=function(r){return e>r?0:r>n?1:(r-e)/t},r.icdf=function(n){return n>=0&&1>=n?e+n*t:NaN},r},i.random.integer=function(e,n){void 0===n&&(n=e,e=0);var t=n-e,r=function(){return e+Math.floor(t*Math.random())};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&n>r?1/t:0},r.cdf=function(r){var i=Math.floor(r);return e>i?0:i>=n?1:(i-e+1)/t},r.icdf=function(n){return n>=0&&1>=n?e-1+Math.floor(n*t):NaN},r},i.random.normal=function(e,n){e=e||0,n=n||1;var t,r=function(){var r,i,o=0,a=0;if(void 0!==t)return o=t,t=void 0,o;do o=2*Math.random()-1,a=2*Math.random()-1,r=o*o+a*a;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),t=e+a*i*n,e+o*i*n};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(t){var r=Math.exp(Math.pow(t-e,2)/(-2*Math.pow(n,2)));return 1/(n*Math.sqrt(2*Math.PI))*r},r.cdf=function(t){var r,i=(t-e)/n,o=Math.abs(i);if(o>37)r=0;else{var a,u=Math.exp(-o*o/2);7.07106781186547>o?(a=.0352624965998911*o+.700383064443688,a=a*o+6.37396220353165,a=a*o+33.912866078383,a=a*o+112.079291497871,a=a*o+221.213596169931,a=a*o+220.206867912376,r=u*a,a=.0883883476483184*o+1.75566716318264,a=a*o+16.064177579207,a=a*o+86.7807322029461,a=a*o+296.564248779674,a=a*o+637.333633378831,a=a*o+793.826512519948,a=a*o+440.413735824752,r/=a):(a=o+.65,a=o+4/a,a=o+3/a,a=o+2/a,a=o+1/a,r=u/a/2.506628274631)}return i>0?1-r:r},r.icdf=function(t){if(0>=t||t>=1)return NaN;var r=2*t-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+n*Math.SQRT2*u},r},i.random.bootstrap=function(e,n){var t=e.filter(r.isValid),o=t.length,a=n?i.random.normal(0,n):null,u=function(){return t[~~(Math.random()*o)]+(a?a():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":8}],5:[function(e,n,t){function r(e,n){return n?void(e[s]=n):e&&e[s]||null}function i(e,n){e=c.array(e),n=c.$(n);var t,r,i;if(e[s]&&(t=n(e[s]),c.isString(t)))return t;for(r=0,i=e.length;!c.isValid(t)&&i>r;++r)t=n?n(e[r]):e[r];return c.isDate(t)?"date":c.isNumber(t)?"number":c.isBoolean(t)?"boolean":c.isString(t)?"string":null}function o(e,n){return e.length?(n=n||c.keys(e[0]),n.reduce(function(n,t){return n[t]=i(e,t),n},{})):void 0}function a(e,n){e=c.array(e),n=c.$(n);var t,r,i,o=["boolean","integer","number","date"];for(t=0;t<e.length;++t){for(i=n?n(e[t]):e[t],r=0;r<o.length;++r)c.isValid(i)&&!p[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}function u(e,n){return n=n||c.keys(e[0]),n.reduce(function(n,t){return n[t]=a(e,t),n},{})}var c=e("../util"),s="__types__",l={"boolean":c["boolean"],integer:c.number,number:c.number,date:c.date,string:function(e){return""===e?null:e}},p={"boolean":function(e){return"true"===e||"false"===e||c.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!c.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};i.annotation=r,i.all=o,i.infer=a,i.inferAll=u,i.parsers=l,n.exports=i},{"../util":8}],6:[function(e,n,t){function r(e,n,t){var r=e&&e.nullh||0,i=c.random.normal(0,1),o=s.mean(n,t),a=s.stdev(n,t)/Math.sqrt(s.count.valid(n,t));if(0===a)return o-r===0?1:0;var u=(o-r)/a;return 2*i.cdf(-Math.abs(u))}function i(e,n,t,r){var i,o=r?n.map(a.$(t)):n,u=r?n.map(a.$(r)):t,c=s.count(o),l=s.count(u),p=Array();if(c!==l)throw Error("Array lengths must match.");for(i=0;c>i;++i)a.isValid(o[i])&&a.isValid(u[i])&&p.push(o[i]-u[i]);return s.z.test(p,e&&e.nullh||0)}function o(e,n,t,r){var i=r?n.map(a.$(t)):n,o=r?n.map(a.$(r)):t,u=s.count.valid(i),l=s.count.valid(o),p=c.random.normal(0,1),f=s.mean(i)-s.mean(o)-(e&&e.nullh||0),E=Math.sqrt(s.variance(i)/u+s.variance(o)/l);if(0===E)return 0===f?1:0;var d=f/E;return 2*p.cdf(-Math.abs(d))}var a=e("./util"),u=e("./import/type"),c=e("./generate"),s=n.exports;s.unique=function(e,n,t){n=a.$(n),t=t||[];var r,i,o,u={};for(i=0,o=e.length;o>i;++i)r=n?n(e[i]):e[i],r in u||(u[r]=1,t.push(r));return t},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,n){n=a.$(n);var t,r,i,o=0;for(r=0,i=e.length;i>r;++r)t=n?n(e[r]):e[r],a.isValid(t)&&(o+=1);return o},s.count.missing=function(e,n){n=a.$(n);var t,r,i,o=0;for(r=0,i=e.length;i>r;++r)t=n?n(e[r]):e[r],null==t&&(o+=1);return o},s.count.distinct=function(e,n){n=a.$(n);var t,r,i,o={},u=0;for(r=0,i=e.length;i>r;++r)t=n?n(e[r]):e[r],t in o||(o[t]=1,u+=1);return u},s.count.map=function(e,n){n=a.$(n);var t,r,i,o={};for(r=0,i=e.length;i>r;++r)t=n?n(e[r]):e[r],o[t]=t in o?o[t]+1:1;return o},s.median=function(e,n){return n&&(e=e.map(a.$(n))),e=e.filter(a.isValid).sort(a.cmp),s.quantile(e,.5)},s.quartile=function(e,n){n&&(e=e.map(a.$(n))),e=e.filter(a.isValid).sort(a.cmp);var t=s.quantile;return[t(e,.25),t(e,.5),t(e,.75)]},s.quantile=function(e,n,t){void 0===t&&(t=n,n=a.identity),n=a.$(n);var r=(e.length-1)*t+1,i=Math.floor(r),o=+n(e[i-1]),u=r-i;return u?o+u*(n(e[i])-o):o},s.sum=function(e,n){n=a.$(n);for(var t,r=0,i=0,o=e.length;o>i;++i)t=n?n(e[i]):e[i],a.isValid(t)&&(r+=t);return r},s.mean=function(e,n){n=a.$(n);var t,r,i,o,u,c=0;for(r=0,o=0,i=e.length;i>r;++r)u=n?n(e[r]):e[r],a.isValid(u)&&(t=u-c,c+=t/++o);return c},s.mean.geometric=function(e,n){n=a.$(n);var t,r,i,o,u=1;for(o=0,t=0,r=e.length;r>o;++o)if(i=n?n(e[o]):e[o],a.isValid(i)){if(0>=i)throw Error("Geometric mean only defined for positive values.");u*=i,++t}return u=t>0?Math.pow(u,1/t):0},s.mean.harmonic=function(e,n){n=a.$(n);var t,r,i,o,u=0;for(o=0,t=0,r=e.length;r>o;++o)i=n?n(e[o]):e[o],a.isValid(i)&&(u+=1/i,++t);return t/u},s.variance=function(e,n){if(n=a.$(n),!a.isArray(e)||e.length<2)return 0;var t,r,i,o,u=0,c=0;for(r=0,i=0;r<e.length;++r)o=n?n(e[r]):e[r],a.isValid(o)&&(t=o-u,u+=t/++i,c+=t*(o-u));return c/=i-1},s.stdev=function(e,n){return Math.sqrt(s.variance(e,n))},s.modeskew=function(e,n){var t=s.mean(e,n),r=s.median(e,n),i=s.stdev(e,n);return 0===i?0:(t-r)/i},s.min=function(e,n){return s.extent(e,n)[0]},s.max=function(e,n){return s.extent(e,n)[1]},s.extent=function(e,n){n=a.$(n);var t,r,i,o,u=e.length;for(o=0;u>o;++o)if(i=n?n(e[o]):e[o],a.isValid(i)){t=r=i;break}for(;u>o;++o)i=n?n(e[o]):e[o],a.isValid(i)&&(t>i&&(t=i),i>r&&(r=i));return[t,r]},s.extent.index=function(e,n){n=a.$(n);var t,r,i,o,u=-1,c=-1,s=e.length;for(o=0;s>o;++o)if(i=n?n(e[o]):e[o],a.isValid(i)){t=r=i,u=c=o;break}for(;s>o;++o)i=n?n(e[o]):e[o],a.isValid(i)&&(t>i&&(t=i,u=o),i>r&&(r=i,c=o));return[u,c]},s.dot=function(e,n,t){var r,i,o=0;if(t)for(n=a.$(n),t=a.$(t),r=0;r<e.length;++r)i=n(e[r])*t(e[r]),i===i&&(o+=i);else{if(e.length!==n.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)i=e[r]*n[r],i===i&&(o+=i)}return o},s.dist=function(e,n,t,r){var i,o,u=a.isFunction(t)||a.isString(t),c=e,s=u?e:n,l=u?r:t,p=2===l||null==l,f=e.length,E=0;for(u&&(n=a.$(n),t=a.$(t)),o=0;f>o;++o)i=u?n(c[o])-t(s[o]):c[o]-s[o],E+=p?i*i:Math.pow(Math.abs(i),l);return p?Math.sqrt(E):Math.pow(E,1/l)},s.cohensd=function(e,n,t){var r=t?e.map(a.$(n)):e,i=t?e.map(a.$(t)):n,o=s.mean(r),u=s.mean(i),c=s.count.valid(r),l=s.count.valid(i);if(0>=c+l-2)return 0;var p=s.variance(r),f=s.variance(i),E=Math.sqrt(((c-1)*p+(l-1)*f)/(c+l-2));return 0===E?0:(o-u)/E},s.covariance=function(e,n,t){var r,i,o,u,c,l=t?e.map(a.$(n)):e,p=t?e.map(a.$(t)):n,f=l.length,E=s.mean(l),d=s.mean(p),y=0,h=0;if(f!==p.length)throw Error("Input lengths must match.");for(r=0;f>r;++r)if(i=l[r],u=a.isValid(i),o=p[r],c=a.isValid(o),u&&c)y+=(i-E)*(o-d),++h;else if(u||c)throw Error("Valid values must align.");return y/(h-1)},s.rank=function(e,n){n=a.$(n)||a.identity;var t,r,i,o=e.map(function(e,t){return{idx:t,val:n(e)}}).sort(a.comparator("val")),u=e.length,c=Array(u),s=-1,l={};for(t=0;u>t;++t){if(r=o[t].val,0>s&&l===r)s=t-1;else if(s>-1&&l!==r){for(i=1+(t-1+s)/2;t>s;++s)c[o[s].idx]=i;s=-1}c[o[t].idx]=t+1,l=r}if(s>-1)for(i=1+(u-1+s)/2;u>s;++s)c[o[s].idx]=i;return c},s.cor=function(e,n,t){var r=t;t=r?e.map(a.$(t)):n,n=r?e.map(a.$(n)):e;var i=s.dot(n,t),o=s.mean(n),u=s.mean(t),c=s.stdev(n),l=s.stdev(t),p=e.length;return(i-p*o*u)/((p-1)*c*l)},s.cor.rank=function(e,n,t){var r,i,o,a=t?s.rank(e,n):s.rank(e),u=t?s.rank(e,t):s.rank(n),c=e.length;for(r=0,i=0;c>r;++r)o=a[r]-u[r],i+=o*o;return 1-6*i/(c*(c*c-1))},s.cor.dist=function(e,n,t){var r,i,o,u,c=t?e.map(a.$(n)):e,l=t?e.map(a.$(t)):n,p=s.dist.mat(c),f=s.dist.mat(l),E=p.length;for(r=0,i=0,o=0,u=0;E>r;++r)i+=p[r]*p[r],o+=f[r]*f[r],u+=p[r]*f[r];return Math.sqrt(u/Math.sqrt(i*o))},s.linearRegression=function(e,n,t){var r,i,o=t?e.map(a.$(n)):e,u=t?e.map(a.$(t)):n,c=o.length,l=s.covariance(o,u),p=s.stdev(o),f=s.stdev(u),E=l/(p*p),d=s.mean(u)-E*s.mean(o),y={slope:E,intercept:d,R:l/(p*f),rss:0};for(i=0;c>i;++i)a.isValid(o[i])&&a.isValid(u[i])&&(r=E*o[i]+d-u[i],y.rss+=r*r);return y},s.bootstrap={},s.bootstrap.ci=function(e,n,t,r,i){var o,u,l,p,f,E,d;for(a.isFunction(n)||a.isString(n)?(o=e.map(a.$(n)),u=t,l=r,p=i):(o=e,u=n,l=t,p=r),u=u?+u:1e3,l=l||.05,f=c.random.bootstrap(o,p),d=0,E=Array(u);u>d;++d)E[d]=s.mean(f.samples(o.length));return E.sort(a.numcmp),[s.quantile(E,l/2),s.quantile(E,1-l/2)]},s.z={},s.z.ci=function(e,n,t){var r=e,i=n;(a.isFunction(n)||a.isString(n))&&(r=e.map(a.$(n)),i=t),i=i||.05;var o=.05===i?1.96:c.random.normal(0,1).icdf(1-i/2),u=s.mean(r),l=s.stdev(r)/Math.sqrt(s.count.valid(r));return[u-o*l,u+o*l]},s.z.test=function(e,n,t,u){return a.isFunction(t)||a.isString(t)?(u&&u.paired?i:o)(u,e,n,t):a.isArray(n)?(t&&t.paired?i:o)(t,e,n):a.isFunction(n)||a.isString(n)?r(t,e,n):r(n,e)},s.dist.mat=function(e){var n,t,r,i=e.length,o=i*i,a=Array(o),u=c.zeros(i),s=0;for(t=0;i>t;++t)for(a[t*i+t]=0,r=t+1;i>r;++r)a[t*i+r]=n=Math.abs(e[t]-e[r]),a[r*i+t]=n,u[t]+=n,u[r]+=n;for(t=0;i>t;++t)s+=u[t],u[t]/=i;for(s/=o,t=0;i>t;++t)for(r=t;i>r;++r)a[t*i+r]+=s-u[t]-u[r],a[r*i+t]=a[t*i+r];return a},s.entropy=function(e,n){n=a.$(n);var t,r,i=0,o=0,u=e.length;for(t=0;u>t;++t)i+=n?n(e[t]):e[t];if(0===i)return 0;for(t=0;u>t;++t)r=(n?n(e[t]):e[t])/i,r&&(o+=r*Math.log(r));return-o/Math.LN2},s.mutual=function(e,n,t,r){var i,o,u,c=r?e.map(a.$(n)):e,s=r?e.map(a.$(t)):n,l=r?e.map(a.$(r)):t,p={},f={},E=l.length,d=0,y=0,h=0;for(u=0;E>u;++u)p[c[u]]=0,f[s[u]]=0;for(u=0;E>u;++u)p[c[u]]+=l[u],f[s[u]]+=l[u],d+=l[u];for(o=1/(d*Math.LN2),u=0;E>u;++u)0!==l[u]&&(i=d*l[u]/(p[c[u]]*f[s[u]]),y+=l[u]*o*Math.log(i),h+=l[u]*o*Math.log(l[u]/d));return[y,1+y/h]},s.mutual.info=function(e,n,t,r){return s.mutual(e,n,t,r)[0]},s.mutual.dist=function(e,n,t,r){return s.mutual(e,n,t,r)[1]},s.profile=function(e,n){var t,r,i,o,c,l=0,p=0,f=0,E=0,d=null,y=null,h=0,T=[],g={};for(i=0;i<e.length;++i)o=n?n(e[i]):e[i],g[o]=o in g?g[o]+1:(E+=1,1),null==o?++f:a.isValid(o)&&(c="string"==typeof o?o.length:o,(null===d||d>c)&&(d=c),(null===y||c>y)&&(y=c),t=c-l,l+=t/++p,h+=t*(c-l),T.push(c));return h/=p-1,r=Math.sqrt(h),T.sort(a.cmp),{type:u(e,n),unique:g,count:e.length,valid:p,missing:f,distinct:E,min:d,max:y,mean:l,stdev:r,median:o=s.quantile(T,.5),q1:s.quantile(T,.25),q3:s.quantile(T,.75),modeskew:0===r?0:(l-o)/r}},s.summary=function(e,n){n=n||a.keys(e[0]);var t=n.map(function(n){var t=s.profile(e,a.$(n));return t.field=n,t});return t.__summary__=!0,t}},{"./generate":4,"./import/type":5,"./util":8}],7:[function(e,n,t){function r(e){return s.setTime(+e),s}function i(e,n,t,r,i,o){var a={type:e,date:n,unit:t};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function o(e,n,t,r,o,a){return i(e,function(e){return n.offset(t,e)},function(e){return n.count(t,e)},r,o,a)}function a(e,n,t,r){var i,o,a,u=d[0];for(i=1,o=d.length;o>i;++i)if(u=d[i],n>u[0]){if(a=n/u[0],a>r)return e[d[i-1][1]];if(a>=t)return e[u[1]]}return e[d[o-1][1]]}function u(e){var n,t,r={};for(n=0,t=e.length;t>n;++n)r[e[n].type]=e[n];return r.find=function(n,t,r){return a(e,n,t,r)},r}var c=e("d3-time"),s=new Date,l=new Date(0,0,1).setFullYear(0),p=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),f=[o("second",c.second,l),o("minute",c.minute,l),o("hour",c.hour,l),o("day",c.day,l,[1,7]),o("month",c.month,l,[1,3,6]),o("year",c.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],E=[o("second",c.utcSecond,p),o("minute",c.utcMinute,p),o("hour",c.utcHour,p),o("day",c.utcDay,p,[1,7]),o("month",c.utcMonth,p,[1,3,6]),o("year",c.utcYear,p),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],d=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];n.exports=u(f),n.exports.utc=u(E)},{"d3-time":2}],8:[function(e,n,t){(function(e){function t(e,n){var t,r="";for(t=0;e>t;++t)r+=n;return r}function r(e,n,t){var r=0,i=e.split(c);return e=t?(i=i.reverse()).filter(function(e){return r+=e.length,n>=r}).reverse():i.filter(function(e){return r+=e.length,n>=r}),e.length?e.join("").trim():i[0].slice(0,n)}var i=n.exports,o="__name__";i.namedfunc=function(e,n){return n[o]=e,n},i.name=function(e){return null==e?null:e[o]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,n){return JSON.stringify(e)===JSON.stringify(n)},i.extend=function(e){for(var n,t,r=1,i=arguments.length;i>r;++r){n=arguments[r];for(t in n)e[t]=n[t]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var n,t=[];for(n in e)t.push(n);return t},i.vals=function(e){var n,t=[];for(n in e)t.push(e[n]);return t},i.toMap=function(e,n){return(n=i.$(n))?e.reduce(function(e,t){return e[n(t)]=1,e},{}):e.reduce(function(e,n){return e[n]=1,e},{})},i.keystr=function(e){var n=e.length;if(!n)return"";for(var t=String(e[0]),r=1;n>r;++r)t+="|"+String(e[r]);return t};var a=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===a.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===a.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===a.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===a.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==a.call(e)},i.isDate=function(e){return"[object Date]"===a.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},i.date=function(e,n){var t=n?n:Date;return null==e||""===e?null:t.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var n;return i.isString(e)&&(n=i.field(e)).length>1?function(e,t){for(var r=0;r<n.length-1;++r)e=e[n[r]];e[n[r]]=t}:function(n,t){n[e]=t}},i.$func=function(e,n){return function(t){t=i.$(t)||i.identity;var r=e+(i.name(t)?"_"+i.name(t):"");return i.namedfunc(r,function(e){return n(t(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,n){e=i.$(e);var t=i.isArray(n)?i.toMap(n):n;return function(n){return!!t[e(n)]}},i.comparator=function(e){var n=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var t=1;return"-"===e[0]?(t=-1,e=e.slice(1)):"+"===e[0]&&(t=1,e=e.slice(1)),n.push(t),i.accessor(e)}),function(t,r){var i,o,a,u,c;for(i=0,o=e.length;o>i;++i){if(a=e[i],u=a(t),c=a(r),c>u)return-1*n[i];if(u>c)return n[i]}return 0}},i.cmp=function(e,n){return n>e?-1:e>n?1:e>=n?0:null===e?-1:null===n?1:NaN},i.numcmp=function(e,n){return e-n},i.stablesort=function(e,n,t){var r=e.reduce(function(e,n,r){return e[t(n)]=r,e},{});return e.sort(function(e,i){var o=n(e),a=n(i);return a>o?-1:o>a?1:r[t(e)]-r[t(i)]}),e},i.permute=function(e){for(var n,t,r=e.length;r;)t=Math.floor(Math.random()*r--),n=e[r],e[r]=e[t],e[t]=n},i.pad=function(e,n,r,i){i=i||" ";var o=n-e.length;if(0>=o)return e;switch(r){case"left":return t(o,i)+e;case"middle":case"center":return t(Math.floor(o/2),i)+e+t(Math.ceil(o/2),i);default:return e+t(o,i)}},i.truncate=function(e,n,t,i,o){var a=e.length;if(n>=a)return e;o=void 0!==o?String(o):"…";var u=Math.max(0,n-o.length);switch(t){case"left":return o+(i?r(e,u,1):e.slice(a-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?r(e,c):e.slice(0,c))+o+(i?r(e,s,1):e.slice(a-s));default:return(i?r(e,u):e.slice(0,u))+o}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:1}],9:[function(e,n,t){"use strict";var r=e("vega-lite/src/channel"),i=e("vega-lite/src/aggregate"),o=e("vega-lite/src/mark"),a=e("vega-lite/src/scale"),u=e("vega-lite/src/sort"),c=e("vega-lite/src/timeunit"),s=e("vega-lite/src/type"),l=e("./property");t.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{overlay:{line:!0},scale:{useRawDomain:!0}},propertyPrecedence:l.DEFAULT_PROPERTY_PRECEDENCE,marks:[o.Mark.POINT,o.Mark.BAR,o.Mark.LINE,o.Mark.AREA,o.Mark.TICK],channels:[r.X,r.Y,r.ROW,r.COLUMN,r.SIZE,r.COLOR],aggregates:[void 0,i.AggregateOp.MEAN],timeUnits:[void 0,c.TimeUnit.YEAR,c.TimeUnit.MONTH,c.TimeUnit.DAY,c.TimeUnit.DATE],types:[s.Type.NOMINAL,s.Type.ORDINAL,s.Type.QUANTITATIVE,s.Type.TEMPORAL],maxBinsList:[5,10,20],sorts:[u.SortOrder.ASCENDING,u.SortOrder.DESCENDING],sortOps:[i.AggregateOp.MIN,i.AggregateOp.MEAN],sortOrders:[u.SortOrder.ASCENDING,u.SortOrder.DESCENDING],scaleBandSizes:[17,21],scaleDomains:[void 0],scaleExponents:[1],scaleRanges:[void 0],scaleTypes:[a.ScaleType.LINEAR,a.ScaleType.LOG],numberOrdinalProportion:.05,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitFacetOverPositionalChannels:!0,omitMultipleNonPositionalChannels:!0,omitNonSumStack:!0,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOverPositionalChannels:!0,omitTableWithOcclusion:!0,omitVerticalDotPlot:!1,preferredBinAxis:r.Channel.X,preferredTemporalAxis:r.Channel.X,preferredOrdinalAxis:r.Channel.Y,preferredNominalAxis:r.Channel.Y,preferredFacet:r.Channel.ROW,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:10,maxCardinalityForShape:6,typeMatchesSchemaType:!0,maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7}},{"./property":22,"vega-lite/src/aggregate":45,"vega-lite/src/channel":47,"vega-lite/src/mark":50,"vega-lite/src/scale":51,"vega-lite/src/sort":52,"vega-lite/src/timeunit":54,"vega-lite/src/type":55}],10:[function(e,n,t){"use strict";var r=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();t.AbstractConstraintModel=r},{}],11:[function(e,n,t){"use strict";var r=e("./encoding"),i=e("./spec");t.encoding=r,t.spec=i},{"./encoding":12,"./spec":13}],12:[function(e,n,t){"use strict";function r(e,n,r,i,o,a){for(var u=t.ENCODING_CONSTRAINTS_BY_PROPERTY[e]||[],c=i.getEncodingQueryByIndex(r),s=0;s<u.length;s++){var l=u[s];if(l.strict()||a[l.name()]){var p=l.satisfy(c,o,a);if(!p){var f="(enc) "+l.name();return a.verbose&&console.log(f+" failed with "+i.toShorthand()+" for "+n.name),f}}}return null}var i=this&&this.__extends||function(e,n){function t(){this.constructor=e}for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)},o=e("vega-lite/src/channel"),a=e("vega-lite/src/scale"),u=e("vega-lite/src/type"),c=e("./base"),s=e("../property"),l=e("../enumspec"),p=e("../schema"),f=e("../util"),E=e("../query/encoding"),d=function(e){function n(n){e.call(this,n)}return i(n,e),n.prototype.hasAllRequiredPropertiesSpecific=function(e){return f.every(this.constraint.properties,function(n){var t=s.getNestedEncodingProperty(n);if(t){var r=t.parent,i=t.child;return e[r]?!l.isEnumSpec(e[r][i]):!0}return e[n]?!l.isEnumSpec(e[n]):!0})},n.prototype.satisfy=function(e,n,t){return this.constraint.allowEnumSpecForProperties||this.hasAllRequiredPropertiesSpecific(e)?this.constraint.satisfy(e,n,t):!0},n}(c.AbstractConstraintModel);t.EncodingConstraintModel=d,t.ENCODING_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[s.Property.TYPE,s.Property.AGGREGATE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){return e.aggregate?e.type!==u.Type.ORDINAL&&e.type!==u.Type.NOMINAL:!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[s.Property.TYPE,s.Property.BIN],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){return e.bin?e.type===u.Type.QUANTITATIVE:!0}},{name:"channelSupportsRole",description:"encoding channel should support the role of the field",properties:[s.Property.CHANNEL,s.Property.TYPE,s.Property.BIN,s.Property.TIMEUNIT],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,n,t){if(l.isEnumSpec(e.channel))return!0;var r=o.getSupportedRole(e.channel);return E.isDimension(e)?r.dimension:E.isMeasure(e)?r.measure:!0}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[s.Property.SCALE,s.Property.SCALE_ZERO,s.Property.BIN],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[s.Property.AGGREGATE,s.Property.AUTOCOUNT,s.Property.TIMEUNIT,s.Property.BIN],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,n,t){var r=(!l.isEnumSpec(e.aggregate)&&e.aggregate?1:0)+(!l.isEnumSpec(e.autoCount)&&e.autoCount?1:0)+(!l.isEnumSpec(e.bin)&&e.bin?1:0)+(!l.isEnumSpec(e.timeUnit)&&e.timeUnit?1:0);return 1>=r}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[s.Property.TYPE,s.Property.TIMEUNIT],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){return!e.timeUnit||e.type===u.Type.TEMPORAL}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:s.SCALE_PROPERTIES.concat([s.Property.SCALE,s.Property.TYPE]),allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,n,t){if(e.scale){var r=e.scale;if(void 0===r.type&&l.isEnumSpec(e.type)||l.isEnumSpec(r.type))return!0;
var i=E.scaleType(r.type,e.timeUnit,e.type);for(var o in r)if(s.SUPPORTED_SCALE_PROPERTY_INDEX[o]&&!f.contains(s.SUPPORTED_SCALE_PROPERTY_INDEX[o],i))return!1}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[s.Property.FIELD,s.Property.TYPE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){var r=n.primitiveType(e.field),i=e.type;switch(r){case p.PrimitiveType.BOOLEAN:case p.PrimitiveType.STRING:return i!==u.Type.QUANTITATIVE&&i!==u.Type.TEMPORAL;case p.PrimitiveType.NUMBER:case p.PrimitiveType.INTEGER:return i!==u.Type.TEMPORAL;case p.PrimitiveType.DATE:return i===u.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[s.Property.FIELD,s.Property.TYPE],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return n.type(e.field)===e.type}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return e.channel===o.Channel.COLOR&&e.type===u.Type.NOMINAL?n.cardinality(e)<=t.maxCardinalityForCategoricalColor:!0}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return e.channel===o.Channel.ROW||e.channel===o.Channel.COLUMN?n.cardinality(e)<=t.maxCardinalityForFacet:!0}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return e.channel===o.Channel.SHAPE?n.cardinality(e)<=t.maxCardinalityForShape:!0}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[s.Property.TYPE,s.Property.SCALE,s.Property.SCALE_TYPE,s.Property.TIMEUNIT,s.Property.BIN],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){if(e.scale){var r=e.type,i=E.scaleType(e.scale.type,e.timeUnit,r);if(f.contains([u.Type.ORDINAL,u.Type.NOMINAL],r))return f.contains([a.ScaleType.ORDINAL,void 0],i);if(r===u.Type.TEMPORAL)return e.timeUnit?f.contains([a.ScaleType.TIME,a.ScaleType.UTC,a.ScaleType.ORDINAL,void 0],i):f.contains([a.ScaleType.TIME,a.ScaleType.UTC,void 0],i);if(r===u.Type.QUANTITATIVE)return e.bin?f.contains([a.ScaleType.LINEAR,void 0],i):f.contains([a.ScaleType.LOG,a.ScaleType.POW,a.ScaleType.SQRT,a.ScaleType.QUANTILE,a.ScaleType.QUANTIZE,a.ScaleType.LINEAR,void 0],i)}return!0}}].map(function(e){return new d(e)}),t.ENCODING_CONSTRAINT_INDEX=t.ENCODING_CONSTRAINTS.reduce(function(e,n){return e[n.name()]=n,e},{}),t.ENCODING_CONSTRAINTS_BY_PROPERTY=t.ENCODING_CONSTRAINTS.reduce(function(e,n){return n.properties().forEach(function(t){e[t]=e[t]||[],e[t].push(n)}),e},{}),t.checkEncoding=r},{"../enumspec":16,"../property":22,"../query/encoding":23,"../schema":34,"../util":35,"./base":10,"vega-lite/src/channel":47,"vega-lite/src/scale":51,"vega-lite/src/type":55}],13:[function(e,n,t){"use strict";function r(e,n,r,i,o){for(var a=t.SPEC_CONSTRAINTS_BY_PROPERTY[e]||[],u=0;u<a.length;u++){var c=a[u];if(c.strict()||o[c.name()]){var s=c.satisfy(r,i,o);if(!s){var l="(spec) "+c.name();return o.verbose&&console.log(l+" failed with "+r.toShorthand()+" for "+n.name),l}}}return null}var i=this&&this.__extends||function(e,n){function t(){this.constructor=e}for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)},o=e("vega-lite/src/aggregate"),a=e("vega-lite/src/channel"),u=e("vega-lite/src/mark"),c=e("vega-lite/src/scale"),s=e("vega-lite/src/type"),l=e("./base"),p=e("../enumspec"),f=e("../property"),E=e("../util"),d=e("../query/encoding"),y=function(e){function n(n){e.call(this,n)}return i(n,e),n.prototype.hasAllRequiredPropertiesSpecific=function(e){return E.every(this.constraint.properties,function(n){if(n===f.Property.MARK)return!p.isEnumSpec(e.getMark());var t=f.getNestedEncodingProperty(n);if(t){var r=t.parent,i=t.child;return E.every(e.getEncodings(),function(e){return e[r]?!p.isEnumSpec(e[r][i]):!0})}if(!f.isEncodingProperty(n))throw new Error("UNIMPLEMENTED");return E.every(e.getEncodings(),function(e){return e[n]?!p.isEnumSpec(e[n]):!0})})},n.prototype.satisfy=function(e,n,t){return this.constraint.allowEnumSpecForProperties||this.hasAllRequiredPropertiesSpecific(e)?this.constraint.satisfy(e,n,t):!0},n}(l.AbstractConstraintModel);t.SpecConstraintModel=y,t.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,n,t){var r={};return E.every(e.getEncodings(),function(e){return p.isEnumSpec(e.channel)?!0:r[e.channel]?!1:(r[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not reccommend bar mark if scale does not start at zero",properties:[f.Property.MARK,f.Property.SCALE,f.Property.SCALE_ZERO,f.Property.CHANNEL,f.Property.TYPE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.BAR)for(var o=0,c=i;o<c.length;o++){var l=c[o];if((l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.type===s.Type.QUANTITATIVE&&l.scale&&l.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[f.Property.BIN,f.Property.TIMEUNIT,f.Property.TYPE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,n,t){var r=E.some(e.getEncodings(),function(e){return e.autoCount===!0});if(r)return E.every(e.getEncodings(),function(e){if(void 0!==e.autoCount)return!0;switch(e.type){case s.Type.QUANTITATIVE:return!!e.bin;case s.Type.TEMPORAL:return!!e.timeUnit;case s.Type.ORDINAL:case s.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=E.every(e.enumSpecIndex.encodingIndicesByProperty.autoCount,function(n){return!p.isEnumSpec(e.getEncodingQueryByIndex(n).autoCount)});return i?E.some(e.getEncodings(),function(e){return e.type===s.Type.QUANTITATIVE?e.autoCount===!1?!1:!e.bin||p.isEnumSpec(e.bin):e.type===s.Type.TEMPORAL?!e.timeUnit||p.isEnumSpec(e.timeUnit):!1}):!0}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[f.Property.CHANNEL,f.Property.MARK],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,n,t){var r=e.getMark();return p.isEnumSpec(r)?!0:E.every(e.getEncodings(),function(e){return p.isEnumSpec(e.channel)?!0:a.supportMark(e.channel,r)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[f.Property.CHANNEL,f.Property.MARK],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:return e.channelUsed(a.Channel.X)&&e.channelUsed(a.Channel.Y);case u.Mark.TEXT:return e.channelUsed(a.Channel.TEXT);case u.Mark.BAR:case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.TICK:case u.Mark.RULE:return e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"All required channels for the specified mark should be specified",properties:[f.Property.CHANNEL,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){if(e.isAggregate()){var r=!1,i=!1;return e.getEncodings().forEach(function(e){e.aggregate||e.autoCount||(i=!0,E.contains([a.Channel.ROW,a.Channel.COLUMN],e.channel)||(r=!0))}),!i||r}return!0}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return E.contains([u.Mark.BAR,u.Mark.LINE,u.Mark.AREA],e.getMark())?e.isAggregate():!0}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[f.Property.CHANNEL,f.Property.MARK],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,n,t){var r=e.getMark();return E.contains([u.Mark.TICK,u.Mark.BAR],r)?!e.channelUsed(a.Channel.SIZE):!0}},{name:"omitFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return e.channelUsed(a.Channel.ROW)||e.channelUsed(a.Channel.COLUMN)?e.channelUsed(a.Channel.X)&&e.channelUsed(a.Channel.Y):!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[f.Property.MARK,f.Property.CHANNEL,f.Property.SCALE,f.Property.SCALE_TYPE,f.Property.TYPE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.AREA||r===u.Mark.BAR)for(var o=0,s=i;o<s.length;o++){var l=s[o];if((l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.scale){var p=d.scaleType(l.scale.type,l.timeUnit,l.type);if(p===c.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,n,t){for(var r=e.getEncodings(),i=0,o=0;o<r.length;o++){var u=r[o].channel;if(!p.isEnumSpec(u)&&(u===a.Channel.COLOR||u===a.Channel.SHAPE||u===a.Channel.SIZE)&&(i+=1,i>1))return!1}return!0}},{name:"omitNonPositionalOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return E.some(a.NONSPATIAL_CHANNELS,function(n){return e.channelUsed(n)})?e.channelUsed(a.Channel.X)&&e.channelUsed(a.Channel.Y):!0}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.TIMEUNIT,f.Property.BIN,f.Property.TYPE],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,n,t){return e.isAggregate()?E.every(e.getEncodings(),function(e){return e.type===s.Type.TEMPORAL?!!e.timeUnit:e.type===s.Type.QUANTITATIVE?!!e.bin||!!e.aggregate||!!e.autoCount:!0}):!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[f.Property.CHANNEL,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,n,t){return e.isAggregate()?!0:E.every(e.getEncodings(),function(e){return e.channel!==a.Channel.DETAIL})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[f.Property.FIELD],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,n,t){var r={};return E.every(e.getEncodings(),function(e){return e.field&&!p.isEnumSpec(e.field)?r[e.field]?!1:(r[e.field]=!0,!0):!0})}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,n,t){var r=e.getEncodings();return 1!==r.length||r[0].channel!==a.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.TYPE,f.Property.TIMEUNIT,f.Property.BIN,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),c=i&&d.isMeasure(i),l=o&&d.isMeasure(o);return i&&o&&c!==l&&!(!c&&i.type===s.Type.NOMINAL)&&!(!l&&o.type===s.Type.NOMINAL)}return!0;case u.Mark.TEXT:return!0;case u.Mark.BAR:case u.Mark.TICK:return e.channelUsed(a.Channel.SIZE)?!1:e.isMeasure(a.Channel.X)!==e.isMeasure(a.Channel.Y);case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitNonSumStack",description:"Stacked plot should use summative aggregation such as sum, count, or distinct",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){var r=e.stack();if(r){var i=e.getEncodingQueryByChannel(r.fieldChannel);return E.contains(o.SUM_OPS,i.aggregate)||!!i.autoCount}return!0}},{name:"omitTableWithOcclusion",description:"Raw Plots with x and y are both dimensions should be omitted as they often lead to occlusion.",properties:[f.Property.CHANNEL,f.Property.TYPE,f.Property.TIMEUNIT,f.Property.BIN,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,n,t){return!e.isDimension(a.Channel.X)||!e.isDimension(a.Channel.Y)||e.isAggregate()}}].map(function(e){return new y(e)}),t.SPEC_CONSTRAINT_INDEX=t.SPEC_CONSTRAINTS.reduce(function(e,n){return e[n.name()]=n,e},{}),t.SPEC_CONSTRAINTS_BY_PROPERTY=t.SPEC_CONSTRAINTS.reduce(function(e,n){return n.properties().forEach(function(t){e[t]=e[t]||[],e[t].push(n)}),e},{}),t.checkSpec=r},{"../enumspec":16,"../property":22,"../query/encoding":23,"../util":35,"./base":10,"vega-lite/src/aggregate":45,"vega-lite/src/channel":47,"vega-lite/src/mark":50,"vega-lite/src/scale":51,"vega-lite/src/type":55}],14:[function(e,n,t){"use strict";t.version="0.3.2";var r=e("./util");t.constraint=e("./constraint/constraint"),t.enumerate=e("./enumerator"),t.enumSpec=e("./enumspec");var i=e("./generate");t.generate=i.generate,t.model=e("./model"),t.modelGroup=e("./modelgroup"),t.nest=e("./nest"),t.property=e("./property");var o=e("./query/query"),a=e("./query/query");t.query=r.extend(a.query,o),t.ranking=e("./ranking/ranking"),t.schema=e("./schema"),t.util=e("./util")},{"./constraint/constraint":11,"./enumerator":15,"./enumspec":16,"./generate":18,"./model":19,"./modelgroup":20,"./nest":21,"./property":22,"./query/query":25,"./ranking/ranking":33,"./schema":34,"./util":35}],15:[function(e,n,t){"use strict";function r(e){return function(n,t,r){return function(a,u){function c(l){if(l===s.length)return void a.push(u.duplicate());var p=s[l],f=n.encodings[p][e],E=u.getEncodingQueryByIndex(p),d=u.getEncodingProperty(p,e);E.autoCount!==!1&&d?(f.values.forEach(function(n){null===n&&(n=void 0),u.setEncodingProperty(p,e,n,f);var a=i.checkEncoding(e,f,p,u,t,r);if(!a){var s=o.checkSpec(e,f,u,t,r);s||c(l+1)}}),u.resetEncodingProperty(p,e,f)):c(l+1)}var s=n.encodingIndicesByProperty[e];return c(0),a}}}var i=e("./constraint/encoding"),o=e("./constraint/spec"),a=e("./property");t.ENUMERATOR_INDEX={},t.ENUMERATOR_INDEX[a.Property.MARK]=function(e,n,t){return function(r,i){var u=i.getMark();return u.values.forEach(function(u){i.setMark(u);var c=o.checkSpec(a.Property.MARK,e.mark,i,n,t);c||r.push(i.duplicate())}),i.resetMark(),r}},a.ENCODING_PROPERTIES.forEach(function(e){t.ENUMERATOR_INDEX[e]=r(e)}),a.NESTED_ENCODING_PROPERTIES.forEach(function(e){t.ENUMERATOR_INDEX[e.property]=r(e.property)}),t.EncodingPropertyGeneratorFactory=r},{"./constraint/encoding":12,"./constraint/spec":13,"./property":22}],16:[function(e,n,t){"use strict";function r(e){return e===t.SHORT_ENUM_SPEC||void 0!==e&&(!!e.values||!!e.name)&&!o.isArray(e)}function i(e,n,t){return o.extend({},{name:n,values:t},e)}var o=e("./util");!function(e){e[e.ENUMSPEC="?"]="ENUMSPEC"}(t.ShortEnumSpec||(t.ShortEnumSpec={}));var a=t.ShortEnumSpec;t.SHORT_ENUM_SPEC=a.ENUMSPEC,t.isEnumSpec=r,t.initEnumSpec=i},{"./util":35}],17:[function(e,n,t){"use strict";var r=e("./property"),i=e("./util"),o=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty={}}return e.prototype.setEncodingProperty=function(e,n,t){var r=this._encodings,i=r[e]=r[e]||{};i[n]=t;var o=this._encodingIndicesByProperty;return(o[n]=o[n]||[]).push(e),this},e.prototype.hasProperty=function(e){if(r.isEncodingProperty(e))return!!this.encodingIndicesByProperty[e];if(e===r.Property.MARK)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===i.keys(this.encodingIndicesByProperty).length},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();t.EnumSpecIndex=o},{"./property":22,"./util":35}],18:[function(e,n,t){"use strict";function r(e,n,t){void 0===t&&(t=o.DEFAULT_QUERY_CONFIG);var r=a.SpecQueryModel.build(e,n,t),u=r.enumSpecIndex,c=[r];return t.propertyPrecedence.forEach(function(e){if(u.hasProperty(e)){var r=i.ENUMERATOR_INDEX[e](u,n,t);c=c.reduce(r,[])}}),c}var i=e("../src/enumerator"),o=e("./config"),a=e("./model");t.generate=r},{"../src/enumerator":15,"./config":9,"./model":19}],19:[function(e,n,t){"use strict";function r(e){switch(e){case u.Property.MARK:return"m";case u.Property.CHANNEL:return"c";case u.Property.AGGREGATE:return"a";case u.Property.AUTOCOUNT:return"#";case u.Property.BIN:return"b";case u.Property.BIN_MAXBINS:return"b-mb";case u.Property.SORT:return"so";case u.Property.SORT_FIELD:return"so-f";case u.Property.SORT_OP:return"so-op";case u.Property.SORT_ORDER:return"so-or";case u.Property.SCALE:return"s";case u.Property.SCALE_BANDSIZE:return"s-bs";case u.Property.SCALE_CLAMP:return"s-c";case u.Property.SCALE_DOMAIN:return"s-d";case u.Property.SCALE_EXPONENT:return"s-e";case u.Property.SCALE_NICE:return"s-n";case u.Property.SCALE_RANGE:return"s-ra";case u.Property.SCALE_ROUND:return"s-r";case u.Property.SCALE_TYPE:return"s-t";case u.Property.SCALE_USERAWDOMAIN:return"s-u";case u.Property.SCALE_ZERO:return"s-z";case u.Property.TIMEUNIT:return"tu";case u.Property.FIELD:return"f";case u.Property.TYPE:return"t"}throw new Error("Default name undefined")}function i(e,n,t){switch(e){case u.Property.FIELD:case u.Property.SORT_FIELD:return n.fields();case u.Property.BIN:case u.Property.SCALE:case u.Property.SCALE_CLAMP:case u.Property.SCALE_NICE:case u.Property.SCALE_ROUND:case u.Property.SCALE_USERAWDOMAIN:case u.Property.SCALE_ZERO:case u.Property.AUTOCOUNT:return[!1,!0];case u.Property.AGGREGATE:return t.aggregates;case u.Property.BIN_MAXBINS:return t.maxBinsList;case u.Property.CHANNEL:return t.channels;case u.Property.MARK:return t.marks;case u.Property.SORT:return t.sorts;case u.Property.SORT_OP:return t.sortOps;case u.Property.SORT_ORDER:return t.sortOrders;case u.Property.SCALE_BANDSIZE:return t.scaleBandSizes;case u.Property.SCALE_DOMAIN:return t.scaleDomains;case u.Property.SCALE_EXPONENT:return t.scaleExponents;case u.Property.SCALE_RANGE:return t.scaleRanges;case u.Property.SCALE_TYPE:return t.scaleTypes;case u.Property.TIMEUNIT:return t.timeUnits;case u.Property.TYPE:return t.types}throw new Error("No default enumValues for "+e)}var o=e("vega-lite/src/aggregate"),a=e("vega-lite/src/type"),u=e("./property"),c=e("./enumspec"),s=e("./enumspecindex"),l=e("./query/spec"),p=e("./query/encoding"),f=e("./query/shorthand"),E=e("./util");t.getDefaultName=r,t.getDefaultEnumValues=i;var d=function(){function e(e,n,t,r,i){this._rankingScore={},this._spec=e,this._channelCount=e.encodings.reduce(function(e,n){return c.isEnumSpec(n.channel)||n.autoCount===!1||(e[n.channel]=1),e},{}),this._enumSpecIndex=n,this._enumSpecAssignment=i,this._opt=r,this._schema=t}return e.build=function(n,t,o){var l=new s.EnumSpecIndex;if(c.isEnumSpec(n.mark)){var p=r(u.Property.MARK);n.mark=c.initEnumSpec(n.mark,p,o.marks),l.setMark(n.mark)}if(n.encodings.forEach(function(e,n){void 0!==e.autoCount&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=a.Type.QUANTITATIVE),void 0===e.type&&(e.type=c.SHORT_ENUM_SPEC),u.ENCODING_PROPERTIES.forEach(function(a){if(c.isEnumSpec(e[a])){var u=r(a)+n,s=i(a,t,o),p=e[a]=c.initEnumSpec(e[a],u,s);l.setEncodingProperty(n,a,p)}}),u.NESTED_ENCODING_PROPERTIES.forEach(function(a){var u=e[a.parent];if(u){var s=a.property,p=a.child;if(c.isEnumSpec(u[p])){var f=r(s)+n,E=i(s,t,o),d=u[p]=c.initEnumSpec(u[p],f,E);l.setEncodingProperty(n,s,d)}}})}),o.autoAddCount){var f={channel:{name:r(u.Property.CHANNEL)+n.encodings.length,values:i(u.Property.CHANNEL,t,o)},autoCount:{name:r(u.Property.AUTOCOUNT)+n.encodings.length,values:[!1,!0]},type:a.Type.QUANTITATIVE};n.encodings.push(f);var E=n.encodings.length-1;l.setEncodingProperty(E,u.Property.CHANNEL,f.channel),l.setEncodingProperty(E,u.Property.AUTOCOUNT,f.autoCount)}return new e(n,l,t,o,{})},Object.defineProperty(e.prototype,"enumSpecIndex",{get:function(){return this._enumSpecIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(E.duplicate(this._spec),this._enumSpecIndex,this._schema,this._opt,E.duplicate(this._enumSpecAssignment))},e.prototype.setMark=function(e){var n=this._spec.mark.name;this._enumSpecAssignment[n]=this._spec.mark=e},e.prototype.resetMark=function(){var e=this._spec.mark=this._enumSpecIndex.mark;delete this._enumSpecAssignment[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,n){var t=this._spec.encodings[e],r=u.getNestedEncodingProperty(n);return r?t[r.parent][r.child]:t[n]},e.prototype.setEncodingProperty=function(e,n,t,r){var i=this._spec.encodings[e],o=u.getNestedEncodingProperty(n);n===u.Property.CHANNEL&&i.channel&&!c.isEnumSpec(i.channel)&&this._channelCount[i.channel]--,o?i[o.parent][o.child]=t:u.hasNestedProperty(n)&&t===!0?i[n]=E.extend({},i[n],{values:void 0,name:void 0}):i[n]=t,this._enumSpecAssignment[r.name]=t,n===u.Property.CHANNEL&&(this._channelCount[t]=(this._channelCount[t]||0)+1)},e.prototype.resetEncodingProperty=function(e,n,t){var r=this._spec.encodings[e],i=u.getNestedEncodingProperty(n);n===u.Property.CHANNEL&&this._channelCount[r.channel]--,i?r[i.parent][i.child]=t:r[n]=t,delete this._enumSpecAssignment[t.name]},e.prototype.channelUsed=function(e){return this._channelCount[e]>0},e.prototype.stack=function(){return l.stack(this._spec)},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return e.autoCount!==!1})},e.prototype.getEncodingQueryByChannel=function(e){for(var n=0;n<this._spec.encodings.length;n++)if(this._spec.encodings[n].channel===e)return this._spec.encodings[n]},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isDimension=function(e){var n=this.getEncodingQueryByChannel(e);return n&&p.isDimension(n)},e.prototype.isMeasure=function(e){var n=this.getEncodingQueryByChannel(e);return n&&p.isMeasure(n)},e.prototype.isAggregate=function(){return l.isAggregate(this._spec)},e.prototype.toShorthand=function(){return f.spec(this._spec)},e.prototype._encoding=function(){for(var e={},n=0;n<this._spec.encodings.length;n++){var t=this._spec.encodings[n],r={};if(t.autoCount===!0)r.aggregate=o.AggregateOp.COUNT,r.field="*",r.type=a.Type.QUANTITATIVE;else if(t.autoCount===!1)continue;if(c.isEnumSpec(t.channel))return null;for(var i=[u.Property.AGGREGATE,u.Property.BIN,u.Property.SORT,u.Property.SCALE,u.Property.TIMEUNIT,u.Property.FIELD,u.Property.TYPE],s=0;s<i.length;s++){var l=i[s];if(c.isEnumSpec(t[l]))return null;void 0!==t[l]&&(r[l]=t[l])}e[t.channel]=r}return e},e.prototype.toSpec=function(e){if(c.isEnumSpec(this._spec.mark))return null;var n={};return e=e||this._spec.data,e&&(n.data=e),this._spec.transform&&(n.transform=this._spec.transform),n.mark=this._spec.mark,n.encoding=this._encoding(),null===n.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(n.config=E.extend({},this._opt.defaultSpecConfig,this._spec.config)),n)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,n){this._rankingScore[e]=n},e}();t.SpecQueryModel=d},{"./enumspec":16,"./enumspecindex":17,"./property":22,"./query/encoding":23,"./query/shorthand":26,"./query/spec":27,"./util":35,"vega-lite/src/aggregate":45,"vega-lite/src/type":55}],20:[function(e,n,t){"use strict";function r(e){return e&&e.hasOwnProperty("items")}function i(e){var n=e.items[0];return r(n)?i(n):n}t.isSpecQueryModelGroup=r,t.getTopItem=i},{}],21:[function(e,n,t){"use strict";function r(e,n){d[e]=n}function i(e,n){var t={name:"",path:"",items:[]},r={};if(n.nest){for(var i=[],o=[],a=[],u=function(e){i.push(e>0?l.duplicate(i[e-1]):{}),o.push(e>0?l.duplicate(o[e-1]):{});var t=n.nest[e].groupBy;if(c.isArray(t)){t.forEach(function(n){p.isExtendedGroupBy(n)?(i[e][n.property]=!0,o[e][n.property]=n.replace):i[e][n]=!0});var r=l.keys(o[e]).reduce(function(n,t){return n[t]=f.getReplacer(o[e][t]),n},{});a.push(r)}},s=0;s<n.nest.length;s++)u(s);e.forEach(function(e){for(var o="",u=t,s=0;s<n.nest.length;s++){var l=u.groupBy=n.nest[s].groupBy;u.orderGroupBy=n.nest[s].orderGroupBy;var p=c.isArray(l)?f.spec(e.specQuery,i[s],a[s]):d[l](e);o+="/"+p,r[o]||(r[o]={name:p,path:o,items:[]},u.items.push(r[o])),u=r[o]}u.items.push(e)})}else t.items=e;return t}function o(e){if(s.isEnumSpec(e))return s.SHORT_ENUM_SPEC+"";var n=e;switch(n){case u.Channel.X:case u.Channel.Y:return"xy";case u.Channel.ROW:case u.Channel.COLUMN:return"facet";case u.Channel.COLOR:case u.Channel.SIZE:case u.Channel.SHAPE:case u.Channel.OPACITY:return"non-xy";case u.Channel.TEXT:case u.Channel.DETAIL:case u.Channel.PATH:case u.Channel.ORDER:return n+"";default:return console.warn("channel type not implemented for "+n),n+""}}function a(e){var n=E.stack(e.specQuery);return n?"stack="+n.offset+"|":""}var u=e("vega-lite/src/channel"),c=e("datalib/src/util"),s=e("./enumspec"),l=e("./util"),p=e("./query/groupby"),f=e("./query/shorthand"),E=e("./query/spec"),d={};t.registerKeyFn=r,t.FIELD="field",t.FIELD_TRANSFORM="fieldTransform",t.ENCODING="encoding",t.TRANSPOSE="transpose",t.SPEC="spec",t.nest=i,r(t.FIELD,function(e){return e.getEncodings().map(function(e){return e.field}).filter(function(e){return e&&"*"!==e}).sort().join("|")}),r(t.FIELD_TRANSFORM,function(e){return e.getEncodings().map(function(e){return f.fieldDef(e)}).sort().join("|")}),r(t.ENCODING,function(e){return a(e)+e.getEncodings().map(function(e){var n=f.fieldDef(e);return o(e.channel)+":"+n}).sort().join("|")}),r(t.TRANSPOSE,function(e){return e.getMark()+"|"+a(e)+e.getEncodings().map(function(e){var n=f.fieldDef(e),t=e.channel===u.Channel.X||e.channel===u.Channel.Y?"xy":e.channel===u.Channel.ROW||e.channel===u.Channel.COLUMN?"facet":e.channel;return t+":"+n}).sort().join("|")}),r(t.SPEC,function(e){return JSON.stringify(e.specQuery)})},{"./enumspec":16,"./query/groupby":24,"./query/shorthand":26,"./query/spec":27,"./util":35,"datalib/src/util":8,"vega-lite/src/channel":47}],22:[function(e,n,t){"use strict";function r(e){switch(e){case s.BIN:case s.SCALE:case s.SORT:return!0;case s.MARK:case s.CHANNEL:case s.AGGREGATE:case s.AUTOCOUNT:case s.TIMEUNIT:case s.FIELD:case s.TYPE:case s.BIN_MAXBINS:case s.SCALE_BANDSIZE:case s.SCALE_CLAMP:case s.SCALE_DOMAIN:case s.SCALE_EXPONENT:case s.SCALE_NICE:case s.SCALE_RANGE:case s.SCALE_ROUND:case s.SCALE_TYPE:case s.SCALE_USERAWDOMAIN:case s.SCALE_ZERO:return!1}throw new Error("hasNestedProperty undefined for property "+e)}function i(e){return void 0!==f[e]}function o(e){return l[e]}function a(e){return p[e]}function u(e){return e in l}var c=e("vega-lite/src/scale");!function(e){e[e.MARK="mark"]="MARK",e[e.CHANNEL="channel"]="CHANNEL",e[e.AGGREGATE="aggregate"]="AGGREGATE",e[e.AUTOCOUNT="autoCount"]="AUTOCOUNT",e[e.BIN="bin"]="BIN",e[e.BIN_MAXBINS="binMaxBins"]="BIN_MAXBINS",e[e.TIMEUNIT="timeUnit"]="TIMEUNIT",e[e.FIELD="field"]="FIELD",e[e.TYPE="type"]="TYPE",e[e.SORT="sort"]="SORT",e[e.SORT_FIELD="sortField"]="SORT_FIELD",e[e.SORT_OP="sortOp"]="SORT_OP",e[e.SORT_ORDER="sortOrder"]="SORT_ORDER",e[e.SCALE="scale"]="SCALE",e[e.SCALE_BANDSIZE="scaleBandSize"]="SCALE_BANDSIZE",e[e.SCALE_CLAMP="scaleClamp"]="SCALE_CLAMP",e[e.SCALE_DOMAIN="scaleDomain"]="SCALE_DOMAIN",e[e.SCALE_EXPONENT="scaleExponent"]="SCALE_EXPONENT",e[e.SCALE_NICE="scaleNice"]="SCALE_NICE",e[e.SCALE_RANGE="scaleRange"]="SCALE_RANGE",e[e.SCALE_ROUND="scaleRound"]="SCALE_ROUND",e[e.SCALE_TYPE="scaleType"]="SCALE_TYPE",e[e.SCALE_USERAWDOMAIN="scaleUseRawDomain"]="SCALE_USERAWDOMAIN",e[e.SCALE_ZERO="scaleZero"]="SCALE_ZERO",e[e.AXIS="axis"]="AXIS",e[e.LEGEND="legend"]="LEGEND"}(t.Property||(t.Property={}));var s=t.Property;t.hasNestedProperty=r,t.ENCODING_PROPERTIES=[s.CHANNEL,s.BIN,s.BIN_MAXBINS,s.TIMEUNIT,s.AGGREGATE,s.AUTOCOUNT,s.FIELD,s.TYPE,s.SORT,s.SORT_FIELD,s.SORT_OP,s.SORT_ORDER,s.SCALE,s.SCALE_BANDSIZE,s.SCALE_CLAMP,s.SCALE_DOMAIN,s.SCALE_EXPONENT,s.SCALE_NICE,s.SCALE_RANGE,s.SCALE_ROUND,s.SCALE_TYPE,s.SCALE_USERAWDOMAIN,s.SCALE_ZERO],t.DEFAULT_PROPERTY_PRECEDENCE=[s.TYPE,s.FIELD,s.BIN,s.TIMEUNIT,s.AGGREGATE,s.AUTOCOUNT,s.SORT,s.SORT_FIELD,s.SORT_OP,s.SORT_ORDER,s.BIN_MAXBINS,s.CHANNEL,s.MARK,s.SCALE,s.SCALE_BANDSIZE,s.SCALE_CLAMP,s.SCALE_DOMAIN,s.SCALE_EXPONENT,s.SCALE_NICE,s.SCALE_RANGE,s.SCALE_ROUND,s.SCALE_TYPE,s.SCALE_USERAWDOMAIN,s.SCALE_ZERO],t.NESTED_ENCODING_PROPERTIES=[{property:s.BIN_MAXBINS,parent:"bin",child:"maxbins"},{property:s.SORT_FIELD,parent:"sort",child:"field"},{property:s.SORT_OP,parent:"sort",child:"op"},{property:s.SORT_ORDER,parent:"sort",child:"order"},{property:s.SCALE_BANDSIZE,parent:"scale",child:"bandSize"},{property:s.SCALE_CLAMP,parent:"scale",child:"clamp"},{property:s.SCALE_DOMAIN,parent:"scale",child:"domain"},{property:s.SCALE_EXPONENT,parent:"scale",child:"exponent"},{property:s.SCALE_NICE,parent:"scale",child:"nice"},{property:s.SCALE_RANGE,parent:"scale",child:"range"},{property:s.SCALE_ROUND,parent:"scale",child:"round"},{property:s.SCALE_TYPE,parent:"scale",child:"type"},{property:s.SCALE_USERAWDOMAIN,parent:"scale",child:"useRawDomain"},{property:s.SCALE_ZERO,parent:"scale",child:"zero"}];var l=t.NESTED_ENCODING_PROPERTIES.reduce(function(e,n){return e[n.property]=n,e},{}),p=t.NESTED_ENCODING_PROPERTIES.reduce(function(e,n){var t=n.parent;return t in e||(e[t]=[]),e[n.parent].push(n),e},{});t.SCALE_PROPERTIES=p.scale.map(function(e){return e.property});var f=t.ENCODING_PROPERTIES.reduce(function(e,n){return e[n]=n,e},{});t.isEncodingProperty=i,t.getNestedEncodingProperty=o,t.getNestedEncodingPropertyChildren=a,t.isNestedEncodingProperty=u;var E=[{property:"bandSize",supportedScaleType:[c.ScaleType.ORDINAL]},{property:"clamp",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"domain",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.ORDINAL,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"exponent",supportedScaleType:[c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT]},{property:"nice",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.TIME,c.ScaleType.UTC]
},{property:"range",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.ORDINAL,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"round",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"useRawDomain",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.ORDINAL,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"zero",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.POW,c.ScaleType.SQRT]}];t.SUPPORTED_SCALE_PROPERTY_INDEX=E.reduce(function(e,n){var t=n.property;return e[t]=n.supportedScaleType,e},{})},{"vega-lite/src/scale":51}],23:[function(e,n,t){"use strict";function r(e){return l.contains([c.Type.NOMINAL,c.Type.ORDINAL],e.type)||!s.isEnumSpec(e.bin)&&!!e.bin||!s.isEnumSpec(e.timeUnit)&&!!e.timeUnit}function i(e){return e.type===c.Type.QUANTITATIVE&&!e.bin||e.type===c.Type.TEMPORAL&&!e.timeUnit}function o(e,n,t){if(void 0!==e)return e;if(!s.isEnumSpec(t)){if(t===c.Type.QUANTITATIVE)return a.ScaleType.LINEAR;if(t===c.Type.ORDINAL||t===c.Type.NOMINAL)return a.ScaleType.ORDINAL;if(t===c.Type.TEMPORAL){if(void 0!==n){if(s.isEnumSpec(n))return;return u.defaultScaleType(n)}return a.ScaleType.TIME}throw new Error}}var a=e("vega-lite/src/scale"),u=e("vega-lite/src/timeunit"),c=e("vega-lite/src/type"),s=e("../enumspec"),l=e("../util");t.isDimension=r,t.isMeasure=i,t.scaleType=o},{"../enumspec":16,"../util":35,"vega-lite/src/scale":51,"vega-lite/src/timeunit":54,"vega-lite/src/type":55}],24:[function(e,n,t){"use strict";function r(e){return o.isObject(e)&&!!e.property}function i(e){return o.isArray(e)?e.map(function(e){if(r(e)){if(e.replace){var n=a.keys(e.replace).reduce(function(n,t){var r=e.replace[t];return(n[r]=n[r]||[]).push(t),n},{});return e.property+"["+a.keys(n).map(function(e){var t=n[e].sort();return t.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}var o=e("datalib/src/util"),a=e("../util");t.REPLACE_BLANK_FIELDS={"*":""},t.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},t.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},t.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},t.isExtendedGroupBy=r,t.toString=i},{"../util":35,"datalib/src/util":8}],25:[function(e,n,t){"use strict";function r(e,n,t){e=s.extend({},i(e),{config:s.extend({},o.DEFAULT_QUERY_CONFIG,t,e.config)});var r=a.generate(e.spec,n,e.config),l=u.nest(r,e),p=c.rank(l,e,n,0);return{query:e,result:p}}function i(e){if(e.groupBy){var n={groupBy:e.groupBy};e.orderBy&&(n.orderGroupBy=e.orderBy);var t={spec:s.duplicate(e.spec),nest:[n]};return e.chooseBy&&(t.chooseBy=e.chooseBy),e.config&&(t.config=e.config),t}return s.duplicate(e)}var o=e("../config"),a=e("../generate"),u=e("../nest"),c=e("../ranking/ranking"),s=e("../util");t.encoding=e("./encoding"),t.groupBy=e("./groupby"),t.shorthand=e("./shorthand"),t.spec=e("./spec"),t.transform=e("./transform"),t.query=r,t.normalize=i},{"../config":9,"../generate":18,"../nest":21,"../ranking/ranking":33,"../util":35,"./encoding":23,"./groupby":24,"./shorthand":26,"./spec":27,"./transform":28}],26:[function(e,n,t){"use strict";function r(e){return function(n){return void 0!==e[n]?e[n]:n}}function i(e,n){return p.isEnumSpec(e)?p.SHORT_ENUM_SPEC:n?n(e):e}function o(e,n,r){void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r={});var o=[];n[f.Property.MARK]&&o.push(i(e.mark,r[f.Property.MARK]));var u=l.stack(e);return u&&o.push("stack="+u.offset),o.push(e.encodings.map(function(e){return a(e,n,r)}).filter(function(e){return!!e}).sort().join("|")),o.join("|")}function a(e,n,r){void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r={});var o=[];n[f.Property.CHANNEL]&&o.push(i(e.channel,r[f.Property.CHANNEL]));var a=u(e,n,r);return a&&o.push(a),o.join(":")}function u(e,n,r){void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r={});var o=null,a=[];if(n[f.Property.AGGREGATE]&&e.autoCount===!1)return"-";if(n[f.Property.AGGREGATE]&&e.aggregate&&!p.isEnumSpec(e.aggregate))o=i(e.aggregate,r[f.Property.AGGREGATE]);else if(n[f.Property.AGGREGATE]&&e.autoCount&&!p.isEnumSpec(e.autoCount))o=i("count",r[f.Property.AGGREGATE]);else if(n[f.Property.TIMEUNIT]&&e.timeUnit&&!p.isEnumSpec(e.timeUnit))o=i(e.timeUnit,r[f.Property.TIMEUNIT]);else if(n[f.Property.BIN]&&e.bin&&!p.isEnumSpec(e.bin))o="bin",n[f.Property.BIN_MAXBINS]&&e.bin.maxbins&&a.push({key:"maxbins",value:i(e.bin.maxbins,r[f.Property.BIN_MAXBINS])});else for(var u=0,l=[f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.TIMEUNIT,f.Property.BIN];u<l.length;u++){var d=l[u];if(n[d]&&e[d]&&p.isEnumSpec(e[d])){o=p.SHORT_ENUM_SPEC+"";break}}for(var y=function(t){if(n[t])if(e[t]&&!p.isEnumSpec(e[t]))if(s.isString(e[t]))a.push({key:t+"",value:e[t]});else{var o=f.getNestedEncodingPropertyChildren(t),u=o.reduce(function(o,a){return n[a.property]&&void 0!==e[t][a.child]&&(o[a.child]=i(e[t][a.child],r[a.property])),o},{});E.keys(u).length>0&&a.push({key:t+"",value:JSON.stringify(u)})}else e[t]!==!1&&null!==e[t]||a.push({key:t+"",value:!1})},h=0,T=[f.Property.SCALE,f.Property.SORT];h<T.length;h++){var g=T[h];y(g)}var S=n[f.Property.FIELD]?i(e.field||"*",r[f.Property.FIELD]):"...";if(n[f.Property.TYPE]){var m=((e.type||c.Type.QUANTITATIVE)+"").substr(0,1);S+=","+i(m,r[f.Property.TYPE])}return S+=a.map(function(e){return","+e.key+"="+e.value}).join(""),o?o+"("+S+")":S}var c=e("vega-lite/src/type"),s=e("datalib/src/util"),l=e("./spec"),p=e("../enumspec"),f=e("../property"),E=e("../util");t.getReplacer=r,t.value=i,t.INCLUDE_ALL=f.DEFAULT_PROPERTY_PRECEDENCE.reduce(function(e,n){return e[n]=!0,e},{}),t.spec=o,t.encoding=a,t.fieldDef=u},{"../enumspec":16,"../property":22,"../util":35,"./spec":27,"datalib/src/util":8,"vega-lite/src/type":55}],27:[function(e,n,t){"use strict";function r(e){return p.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},{mark:e.mark,encodings:p.keys(e.encoding).map(function(n){for(var t={channel:n},r=e.encoding[n],i=0,o=l.ENCODING_PROPERTIES;i<o.length;i++){var a=o[i];l.isNestedEncodingProperty(a)||void 0===r[a]||(t[a]=r[a]),p.contains([l.Property.SCALE,l.Property.AXIS,l.Property.LEGEND],a)&&null===t[a]&&(t[a]=!1)}return t})},e.config?{config:e.config}:{})}function i(e){return p.some(e.encodings,function(e){return!s.isEnumSpec(e.aggregate)&&!!e.aggregate||e.autoCount===!0})}function o(e){var n=e.config,t=n&&n.mark?n.mark.stacked:void 0;if(p.contains([c.StackOffset.NONE,null,!1],t))return null;if(!p.contains([u.BAR,u.AREA],e.mark))return null;if(!i(e))return null;var r=e.encodings.reduce(function(e,n){return p.contains(a.STACK_GROUP_CHANNELS,n.channel)&&!n.aggregate&&e.push(n.channel),e},[]);if(0===r.length)return null;var o=e.encodings.reduce(function(e,n){return e||(n.channel===a.Channel.X?n:null)},null),s=e.encodings.reduce(function(e,n){return e||(n.channel===a.Channel.Y?n:null)},null),l=!(!o||!o.aggregate&&!o.autoCount),f=!(!s||!s.aggregate&&!s.autoCount);return l!==f?{groupbyChannel:l?s?a.Y:null:o?a.X:null,fieldChannel:l?a.X:a.Y,stackByChannels:r,offset:t||c.StackOffset.ZERO}:null}var a=e("vega-lite/src/channel"),u=e("vega-lite/src/mark"),c=e("vega-lite/src/stack"),s=e("../enumspec"),l=e("../property"),p=e("../util");t.fromSpec=r,t.isAggregate=i,t.stack=o},{"../enumspec":16,"../property":22,"../util":35,"vega-lite/src/channel":47,"vega-lite/src/mark":50,"vega-lite/src/stack":53}],28:[function(e,n,t){"use strict"},{}],29:[function(e,n,t){"use strict";var r,i=e("vega-lite/src/channel"),o=e("../../config"),a=e("../../query/shorthand"),u=e("../../util"),c=e("./effectiveness"),s=e("./type");!function(e){function n(){var e={},n={x:0,y:0,size:-.45,color:-.6,opacity:-.75,text:-.775,row:-.8,column:-.8,shape:-2.5,detail:-3};[s.Q,s.BIN_Q,s.T,s.TIMEUNIT_T,s.O].forEach(function(r){u.keys(n).forEach(function(i){e[t(r,i)]=n[i]})}),[s.BIN_Q,s.TIMEUNIT_T,s.O].forEach(function(n){[i.Channel.ROW,i.Channel.COLUMN].forEach(function(r){e[t(n,r)]+=.25})});var r={x:0,y:0,color:-.5,shape:-.6,row:-.7,column:-.7,text:-.8,size:-1.8,detail:-2,opacity:-2.1};return u.keys(r).forEach(function(n){e[t(s.N,n)]=r[n]}),e}function t(e,n){return e+"_"+n}function r(n,r,i){var o=n.getEncodings().reduce(function(e,n){var t=a.fieldDef(n);return(e[t]=e[t]||[]).push(n),e},{}),s=[];return u.forEach(o,function(n){var r=n.reduce(function(n,r){var i=c.getExtendedType(r),o=t(i,r.channel),a=c.getFeatureScore(e.TYPE_CHANNEL,o);return null===n||a.score>n.score?a:n},null);s.push(r)}),s}e.TYPE_CHANNEL="typeChannel",e.init=n,e.featurize=t,e.getScore=r}(r=t.TypeChannelScore||(t.TypeChannelScore={}));var l;!function(e){function n(e){void 0===e&&(e={}),e=u.extend({},o.DEFAULT_QUERY_CONFIG,e);var n={},t=[{feature:"bin_"+s.Q,opt:"preferredBinAxis"},{feature:s.T,opt:"preferredTemporalAxis"},{feature:s.O,opt:"preferredOrdinalAxis"},{feature:s.N,opt:"preferredNominalAxis"}];return t.forEach(function(t){e[t.opt]===i.Channel.X?n[t.feature+"_"+i.Channel.Y]=-.01:e[t.opt]===i.Channel.Y&&(n[t.feature+"_"+i.Channel.X]=-.01)}),n}function t(e,n){return e+"_"+n}function r(n,r,i){return n.getEncodings().reduce(function(n,r){var i=c.getExtendedType(r),o=t(i,r.channel),a=c.getFeatureScore(e.PREFERRED_AXIS,o);return a&&n.push(a),n},[])}e.PREFERRED_AXIS="preferredAxis",e.init=n,e.featurize=t,e.getScore=r}(l=t.PreferredAxisScore||(t.PreferredAxisScore={}));var p;!function(e){function n(e){e=u.extend({},o.DEFAULT_QUERY_CONFIG,e);var n={};return e.preferredFacet===i.Channel.ROW?n[i.Channel.COLUMN]=-.01:e.preferredFacet===i.Channel.COLUMN&&(n[i.Channel.ROW]=-.01),n}function t(n,t,r){return n.getEncodings().reduce(function(n,t){var r=c.getFeatureScore(e.PREFERRED_FACET,t.channel);return r&&n.push(r),n},[])}e.PREFERRED_FACET="preferredFacet",e.init=n,e.getScore=t}(p=t.PreferredFacetScore||(t.PreferredFacetScore={}));var f;!function(e){function n(){return{bar_size:-2,tick_size:-2}}function t(n,t,r){var i=n.getMark();return n.getEncodings().reduce(function(n,t){var r=i+"_"+t.channel,o=c.getFeatureScore(e.MARK_CHANNEL,r);return o&&n.push(o),n},[])}e.MARK_CHANNEL="markChannel",e.init=n,e.getScore=t}(f=t.MarkChannelScore||(t.MarkChannelScore={}));var E;!function(e){function n(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}}function t(n,t,r){return n.isAggregate()&&n.getEncodings().reduce(function(n,t){if(!t.aggregate&&!t.autoCount){var r=c.getFeatureScore(e.DIMENSION,t.channel+"");if(r.score>n.score)return r}return n},{type:e.DIMENSION,feature:"No Dimension",score:-5}),[]}e.DIMENSION="dimension",e.init=n,e.getScore=t}(E=t.DimensionScore||(t.DimensionScore={}))},{"../../config":9,"../../query/shorthand":26,"../../util":35,"./effectiveness":30,"./type":32,"vega-lite/src/channel":47}],30:[function(e,n,t){"use strict";function r(e,n){var r=t.FEATURE_INDEX[e][n];return void 0!==r?{score:r,type:e,feature:n}:null}function i(e){s.push(e),t.FEATURE_INDEX[e.type]=e.init()}function o(e){return(e.bin?"bin_":e.timeUnit?"timeUnit_":"")+e.type}function a(e,n,t){var r=s.reduce(function(r,i){var o=i.getScore(e,n,t);return r.concat(o)},[]);return{score:r.reduce(function(e,n){return e+n.score},0),features:r}}var u=e("./channel"),c=e("./mark");t.FEATURE_INDEX={};var s=[];t.getFeatureScore=r,t.addFeatureFactory=i,i({type:u.TypeChannelScore.TYPE_CHANNEL,init:u.TypeChannelScore.init,getScore:u.TypeChannelScore.getScore}),i({type:u.PreferredAxisScore.PREFERRED_AXIS,init:u.PreferredAxisScore.init,getScore:u.PreferredAxisScore.getScore}),i({type:u.PreferredFacetScore.PREFERRED_FACET,init:u.PreferredFacetScore.init,getScore:u.PreferredFacetScore.getScore}),i({type:u.MarkChannelScore.MARK_CHANNEL,init:u.MarkChannelScore.init,getScore:u.MarkChannelScore.getScore}),i({type:c.MarkScore.MARK_SCORE,init:c.MarkScore.init,getScore:c.MarkScore.getScore}),t.getExtendedType=o,Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a},{"./channel":29,"./mark":31}],31:[function(e,n,t){"use strict";var r,i=e("vega-lite/src/channel"),o=e("vega-lite/src/mark"),a=e("../../util"),u=e("./effectiveness"),c=e("./type");!function(e){function n(e,n,t,r){return e+"_"+n+"_"+t+"_"+r}function t(){var e=[c.Q,c.T],t=[c.BIN_Q,c.TIMEUNIT_T,c.O,c.N],r=t.concat([c.NONE]),i={};return e.forEach(function(t){e.forEach(function(e){var r={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};a.forEach(r,function(r,o){var a=n(t,e,!0,o);i[a]=r});var o={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};a.forEach(o,function(r,o){var a=n(t,e,!1,o);i[a]=r})})}),e.forEach(function(e){r.forEach(function(t){var r={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};a.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r;var u=n(t,e,!0,o);i[u]=r})}),[c.NONE,c.N].forEach(function(t){var r={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};a.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r;var u=n(t,e,!1,o);i[u]=r})}),[c.BIN_Q].forEach(function(t){var r={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};a.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r;var u=n(t,e,!1,o);i[u]=r})}),[c.TIMEUNIT_T,c.O].forEach(function(t){var r={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};a.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r;var u=n(t,e,!1,o);i[u]=r})})}),r.forEach(function(e){r.forEach(function(t){var r={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};a.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r}),a.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r})})}),i}function r(n,t,r){var a=n.getMark();a!==o.Mark.CIRCLE&&a!==o.Mark.SQUARE||(a=o.Mark.POINT);var c=n.getEncodingQueryByChannel(i.Channel.X),s=c?u.getExtendedType(c):"-",l=n.getEncodingQueryByChannel(i.Channel.Y),p=l?u.getExtendedType(l):"-",f=!n.isAggregate(),E=s+"_"+p+"_"+f+"_"+a,d=u.getFeatureScore(e.MARK_SCORE,E);return[d]}e.MARK_SCORE="markScore",e.featurize=n,e.init=t,e.getScore=r}(r=t.MarkScore||(t.MarkScore={}))},{"../../util":35,"./effectiveness":30,"./type":32,"vega-lite/src/channel":47,"vega-lite/src/mark":50}],32:[function(e,n,t){"use strict";var r=e("vega-lite/src/type");!function(e){e[e.Q=r.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+r.Type.QUANTITATIVE]="BIN_Q",e[e.T=r.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_"+r.Type.TEMPORAL]="TIMEUNIT_T",e[e.O=r.Type.ORDINAL]="O",e[e.N=r.Type.NOMINAL]="N",e[e.NONE="-"]="NONE"}(t.ExtendedType||(t.ExtendedType={}));var i=t.ExtendedType;t.Q=i.Q,t.BIN_Q=i.BIN_Q,t.T=i.T,t.TIMEUNIT_T=i.TIMEUNIT_T,t.O=i.O,t.N=i.N,t.NONE=i.NONE},{"vega-lite/src/type":55}],33:[function(e,n,t){"use strict";function r(e,n){l[e]=n}function i(e){return l[e]}function o(e,n,t,r){return n.nest&&r!==n.nest.length?(e.items.forEach(function(e){o(e,n,t,r+1)}),n.nest[r].orderGroupBy&&e.items.sort(c(n.nest[r].orderGroupBy,t,n.config))):(n.orderBy||n.chooseBy)&&(e.items.sort(u(n.orderBy||n.chooseBy,t,n.config)),n.chooseBy&&(e.items=[e.items[0]])),e}function a(e,n,t,r){if(void 0!==e.getRankingScore(n))return e.getRankingScore(n);var o=i(n),a=o(e,t,r);return e.setRankingScore(n,a),a}function u(e,n,t){return function(r,i){return a(i,e,n,t).score-a(r,e,n,t).score}}function c(e,n,t){return function(r,i){var o=s.getTopItem(r),u=s.getTopItem(i);return a(u,e,n,t).score-a(o,e,n,t).score}}var s=e("../modelgroup");t.effectiveness=e("./effectiveness/effectiveness");var l={};t.register=r,t.get=i,t.rank=o,t.comparator=u,t.groupComparator=c,t.EFFECTIVENESS="effectiveness",r(t.EFFECTIVENESS,t.effectiveness["default"])},{"../modelgroup":20,"./effectiveness/effectiveness":30}],34:[function(e,n,t){"use strict";function r(e,n){var t=c({min:n.min,max:n.max,maxbins:e}),r=l.extend({},n);return r.distinct=(t.stop-t.start)/t.step,r}var i=e("vega-lite/src/type"),o=e("vega-lite/src/bin"),a=e("datalib/src/stats"),u=e("datalib/src/import/type"),c=e("datalib/src/bins/bins"),s=e("./config"),l=e("./util"),p=function(){function e(e){this.fieldSchemas=e,this.fieldSchemaIndex=e.reduce(function(e,n){return e[n.field]=n,e},{})}return e.build=function(n,t){void 0===t&&(t={}),t=l.extend({},s.DEFAULT_QUERY_CONFIG,t);var o=a.summary(n),c=u.inferAll(n),p=o.map(function(e){var n,r=e.field,o=c[r],a=e.distinct;return n=o===f.NUMBER?i.Type.QUANTITATIVE:o===f.INTEGER?a/e.count<t.numberOrdinalProportion?e.max-e.min===a-1&&l.contains([0,1],e.min)?i.Type.NOMINAL:i.Type.ORDINAL:i.Type.QUANTITATIVE:o===f.DATE?i.Type.TEMPORAL:i.Type.NOMINAL,{field:r,type:n,primitiveType:o,stats:e}}),E={nominal:0,ordinal:1,temporal:2,quantitative:3};p.sort(function(e,n){return E[e.type]<E[n.type]?-1:E[e.type]>E[n.type]?1:e.field.localeCompare(n.field)});for(var d=new e(p),y=0,h=p;y<h.length;y++){var T=h[y];if(T.type===i.Type.QUANTITATIVE){T.binStats={};for(var g=0,S=t.maxBinsList;g<S.length;g++){var m=S[g];T.binStats[m]=r(m,T.stats)}}else if(T.type===i.Type.TEMPORAL){T.stats.min=new Date(n[0][T.field]),T.stats.max=new Date(n[0][T.field]);for(var A=0;A<n.length;A++){var N=new Date(n[A][T.field]).getTime();N<T.stats.min.getTime()&&(T.stats.min=new Date(N)),N>T.stats.max.getTime()&&(T.stats.max=new Date(N))}}}return d},e.prototype.fields=function(){return this.fieldSchemas.map(function(e){return e.field})},e.prototype.primitiveType=function(e){return this.fieldSchemaIndex[e]?this.fieldSchemaIndex[e].primitiveType:null},e.prototype.type=function(e){return this.fieldSchemaIndex[e]?this.fieldSchemaIndex[e].type:null},e.prototype.cardinality=function(e){if(e.aggregate||e.autoCount)return 1;if(e.bin){var n;n="boolean"==typeof e.bin?{maxbins:o.autoMaxBins(e.channel)}:e.bin;var t=this.fieldSchemaIndex[e.field],i=n.maxbins;return t.binStats[i]||(t.binStats[i]=r(i,t.stats)),t.binStats[i].distinct}if(e.timeUnit)return 1;var a=this.fieldSchemaIndex[e.field];return a?a.stats.distinct:null},e.prototype.domain=function(e){var n=this.fieldSchemaIndex[e.field],t=l.keys(n.stats.unique);return n.type===i.Type.QUANTITATIVE||n.primitiveType===f.DATE?t=[n.stats.min,n.stats.max]:n.primitiveType!==f.INTEGER&&n.primitiveType!==f.NUMBER||(t=t.map(function(e){return+e})),t.sort()},e.prototype.stats=function(e){var n=this.fieldSchemaIndex[e.field];return n?n.stats:null},e}();t.Schema=p,function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATE="date"]="DATE"}(t.PrimitiveType||(t.PrimitiveType={}));var f=t.PrimitiveType},{"./config":9,"./util":35,"datalib/src/bins/bins":3,"datalib/src/import/type":5,"datalib/src/stats":6,"vega-lite/src/bin":46,"vega-lite/src/type":55}],35:[function(e,n,t){"use strict";function r(e,n){return-1!==e.indexOf(n)}function i(e,n){var t,r=0;for(t in e)if(!n(e[t],t,r++))return!1;return!0}function o(e,n,t){if(e.forEach)e.forEach.call(t,n);else for(var r in e)n.call(t,e[r],r,e)}function a(e,n){var t,r=0;for(t in e)if(n(e[t],t,r++))return!0;return!1}function u(e,n){return e.map(function(e){return s.isArray(e)?u(e,n):n(e)})}function c(e,n){return e.filter(function(e){return!r(n,e)})}var s=e("datalib/src/util"),l=e("datalib/src/util");t.keys=l.keys,t.duplicate=l.duplicate,t.extend=l.extend,t.isObject=l.isObject,t.isArray=l.isArray,t.contains=r,t.every=i,t.forEach=o,t.some=a,t.nestedMap=u,t.without=c},{"datalib/src/util":8}],36:[function(e,n,t){arguments[4][2][0].apply(t,arguments)},{dup:2}],37:[function(e,n,t){arguments[4][3][0].apply(t,arguments)},{"../time":39,"../util":40,dup:3}],38:[function(e,n,t){arguments[4][4][0].apply(t,arguments)},{"./util":40,dup:4}],39:[function(e,n,t){arguments[4][7][0].apply(t,arguments)},{"d3-time":36,dup:7}],40:[function(e,n,t){(function(e){function t(e,n){var t,r="";for(t=0;e>t;++t)r+=n;return r}function r(e,n,t){var r=0,i=e.split(c);return e=t?(i=i.reverse()).filter(function(e){return r+=e.length,n>=r}).reverse():i.filter(function(e){return r+=e.length,n>=r}),e.length?e.join("").trim():i[0].slice(0,n)}var i=n.exports,o="__name__";i.namedfunc=function(e,n){return n[o]=e,n},i.name=function(e){return null==e?null:e[o]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,n){return JSON.stringify(e)===JSON.stringify(n)},i.extend=function(e){for(var n,t,r=1,i=arguments.length;i>r;++r){n=arguments[r];for(t in n)e[t]=n[t]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var n,t=[];for(n in e)t.push(n);return t},i.vals=function(e){var n,t=[];for(n in e)t.push(e[n]);return t},i.toMap=function(e,n){return(n=i.$(n))?e.reduce(function(e,t){return e[n(t)]=1,e},{}):e.reduce(function(e,n){return e[n]=1,e},{})},i.keystr=function(e){var n=e.length;if(!n)return"";for(var t=String(e[0]),r=1;n>r;++r)t+="|"+String(e[r]);return t};var a=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===a.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===a.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===a.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===a.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==a.call(e)},i.isDate=function(e){return"[object Date]"===a.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},i.date=function(e,n){var t=n?n:Date;return null==e||""===e?null:t.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var n;return i.isString(e)&&(n=i.field(e)).length>1?function(e,t){for(var r=0;r<n.length-1;++r)e=e[n[r]];e[n[r]]=t}:function(n,t){n[e]=t}},i.$func=function(e,n){return function(t){t=i.$(t)||i.identity;var r=e+(i.name(t)?"_"+i.name(t):"");return i.namedfunc(r,function(e){return n(t(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,n){e=i.$(e);var t=i.isArray(n)?i.toMap(n):n;return function(n){return!!t[e(n)]}},i.comparator=function(e){var n=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var t=1;return"-"===e[0]?(t=-1,e=e.slice(1)):"+"===e[0]&&(t=1,e=e.slice(1)),n.push(t),i.accessor(e)}),function(t,r){var o,a,u,c;for(o=0,a=e.length;a>o;++o)if(u=e[o],c=i.cmp(u(t),u(r)))return c*n[o];return 0}},i.cmp=function(e,n){return(n>e||null==e)&&null!=n?-1:(e>n||null==n)&&null!=e?1:(n=n instanceof Date?+n:n,(e=e instanceof Date?+e:e)!==e&&n===n?-1:n!==n&&e===e?1:0)},i.numcmp=function(e,n){return e-n},i.stablesort=function(e,n,t){var r=e.reduce(function(e,n,r){return e[t(n)]=r,e},{});return e.sort(function(e,i){var o=n(e),a=n(i);return a>o?-1:o>a?1:r[t(e)]-r[t(i)]}),e},i.permute=function(e){for(var n,t,r=e.length;r;)t=Math.floor(Math.random()*r--),n=e[r],e[r]=e[t],e[t]=n},i.pad=function(e,n,r,i){i=i||" ";var o=n-e.length;if(0>=o)return e;switch(r){case"left":return t(o,i)+e;case"middle":case"center":return t(Math.floor(o/2),i)+e+t(Math.ceil(o/2),i);default:return e+t(o,i)}},i.truncate=function(e,n,t,i,o){var a=e.length;if(n>=a)return e;o=void 0!==o?String(o):"…";var u=Math.max(0,n-o.length);switch(t){case"left":return o+(i?r(e,u,1):e.slice(a-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?r(e,c):e.slice(0,c))+o+(i?r(e,s,1):e.slice(a-s));default:return(i?r(e,u):e.slice(0,u))+o}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:1}],41:[function(e,n,t){var r="undefined"!=typeof JSON?JSON:e("jsonify");n.exports=function(e,n){n||(n={}),"function"==typeof n&&(n={cmp:n});var t=n.space||"";"number"==typeof t&&(t=Array(t+1).join(" "));var a="boolean"==typeof n.cycles?n.cycles:!1,u=n.replacer||function(e,n){return n},c=n.cmp&&function(e){return function(n){return function(t,r){var i={key:t,value:n[t]},o={key:r,value:n[r]};return e(i,o)}}}(n.cmp),s=[];return function l(e,n,p,f){var E=t?"\n"+new Array(f+1).join(t):"",d=t?": ":":";if(p&&p.toJSON&&"function"==typeof p.toJSON&&(p=p.toJSON()),p=u.call(e,n,p),void 0!==p){if("object"!=typeof p||null===p)return r.stringify(p);if(i(p)){for(var y=[],h=0;h<p.length;h++){var T=l(p,h,p[h],f+1)||r.stringify(null);y.push(E+t+T)}return"["+y.join(",")+E+"]"}if(-1!==s.indexOf(p)){if(a)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}s.push(p);for(var g=o(p).sort(c&&c(p)),y=[],h=0;h<g.length;h++){var n=g[h],S=l(p,n,p[n],f+1);if(S){var m=r.stringify(n)+d+S;y.push(E+t+m)}}return s.splice(s.indexOf(p),1),"{"+y.join(",")+E+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var n=Object.prototype.hasOwnProperty||function(){return!0},t=[];for(var r in e)n.call(e,r)&&t.push(r);return t}},{jsonify:42}],42:[function(e,n,t){t.parse=e("./lib/parse"),t.stringify=e("./lib/stringify")},{"./lib/parse":43,"./lib/stringify":44}],43:[function(e,n,t){var r,i,o,a,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},c=function(e){throw{name:"SyntaxError",message:e,at:r,text:o}},s=function(e){return e&&e!==i&&c("Expected '"+e+"' instead of '"+i+"'"),i=o.charAt(r),r+=1,i},l=function(){var e,n="";for("-"===i&&(n="-",s("-"));i>="0"&&"9">=i;)n+=i,s();if("."===i)for(n+=".";s()&&i>="0"&&"9">=i;)n+=i;if("e"===i||"E"===i)for(n+=i,s(),"-"!==i&&"+"!==i||(n+=i,s());i>="0"&&"9">=i;)n+=i,s();return e=+n,isFinite(e)?e:void c("Bad number")},p=function(){var e,n,t,r="";if('"'===i)for(;s();){if('"'===i)return s(),r;if("\\"===i)if(s(),"u"===i){for(t=0,n=0;4>n&&(e=parseInt(s(),16),isFinite(e));n+=1)t=16*t+e;r+=String.fromCharCode(t)}else{if("string"!=typeof u[i])break;r+=u[i]}else r+=i}c("Bad string")},f=function(){for(;i&&" ">=i;)s()},E=function(){switch(i){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}c("Unexpected '"+i+"'")},d=function(){var e=[];if("["===i){if(s("["),f(),"]"===i)return s("]"),e;for(;i;){if(e.push(a()),f(),"]"===i)return s("]"),e;s(","),f()}}c("Bad array")},y=function(){var e,n={};if("{"===i){if(s("{"),f(),"}"===i)return s("}"),n;for(;i;){if(e=p(),f(),s(":"),Object.hasOwnProperty.call(n,e)&&c('Duplicate key "'+e+'"'),n[e]=a(),f(),"}"===i)return s("}"),n;s(","),f()}}c("Bad object")};a=function(){switch(f(),i){case"{":return y();case"[":return d();case'"':return p();case"-":return l();default:return i>="0"&&"9">=i?l():E()}},n.exports=function(e,n){var t;return o=e,r=0,i=" ",t=a(),f(),i&&c("Syntax error"),"function"==typeof n?function u(e,t){var r,i,o=e[t];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=u(o,r),void 0!==i?o[r]=i:delete o[r]);return n.call(e,t,o)}({"":t},""):t}},{}],44:[function(e,n,t){function r(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var n=s[e];return"string"==typeof n?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,n){var t,c,s,l,p,f=o,E=n[e];switch(E&&"object"==typeof E&&"function"==typeof E.toJSON&&(E=E.toJSON(e)),"function"==typeof u&&(E=u.call(n,e,E)),typeof E){case"string":return r(E);case"number":return isFinite(E)?String(E):"null";case"boolean":case"null":return String(E);case"object":if(!E)return"null";if(o+=a,p=[],"[object Array]"===Object.prototype.toString.apply(E)){for(l=E.length,t=0;l>t;t+=1)p[t]=i(t,E)||"null";return s=0===p.length?"[]":o?"[\n"+o+p.join(",\n"+o)+"\n"+f+"]":"["+p.join(",")+"]",o=f,s}if(u&&"object"==typeof u)for(l=u.length,t=0;l>t;t+=1)c=u[t],"string"==typeof c&&(s=i(c,E),s&&p.push(r(c)+(o?": ":":")+s));else for(c in E)Object.prototype.hasOwnProperty.call(E,c)&&(s=i(c,E),s&&p.push(r(c)+(o?": ":":")+s));return s=0===p.length?"{}":o?"{\n"+o+p.join(",\n"+o)+"\n"+f+"}":"{"+p.join(",")+"}",o=f,s}}var o,a,u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};n.exports=function(e,n,t){var r;if(o="",a="","number"==typeof t)for(r=0;t>r;r+=1)a+=" ";else"string"==typeof t&&(a=t);if(u=n,n&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],45:[function(e,n,t){"use strict";!function(e){e[e.VALUES="values"]="VALUES",e[e.COUNT="count"]="COUNT",e[e.VALID="valid"]="VALID",e[e.MISSING="missing"]="MISSING",e[e.DISTINCT="distinct"]="DISTINCT",e[e.SUM="sum"]="SUM",e[e.MEAN="mean"]="MEAN",e[e.AVERAGE="average"]="AVERAGE",e[e.VARIANCE="variance"]="VARIANCE",e[e.VARIANCEP="variancep"]="VARIANCEP",e[e.STDEV="stdev"]="STDEV",e[e.STDEVP="stdevp"]="STDEVP",e[e.MEDIAN="median"]="MEDIAN",e[e.Q1="q1"]="Q1",e[e.Q3="q3"]="Q3",e[e.MODESKEW="modeskew"]="MODESKEW",e[e.MIN="min"]="MIN",e[e.MAX="max"]="MAX",e[e.ARGMIN="argmin"]="ARGMIN",e[e.ARGMAX="argmax"]="ARGMAX"}(t.AggregateOp||(t.AggregateOp={}));var r=t.AggregateOp;t.AGGREGATE_OPS=[r.VALUES,r.COUNT,r.VALID,r.MISSING,r.DISTINCT,r.SUM,r.MEAN,r.AVERAGE,r.VARIANCE,r.VARIANCEP,r.STDEV,r.STDEVP,r.MEDIAN,r.Q1,r.Q3,r.MODESKEW,r.MIN,r.MAX,r.ARGMIN,r.ARGMAX],t.SUM_OPS=[r.COUNT,r.SUM,r.DISTINCT],t.SHARED_DOMAIN_OPS=[r.MEAN,r.AVERAGE,r.STDEV,r.STDEVP,r.MEDIAN,r.Q1,r.Q3,r.MIN,r.MAX]},{}],46:[function(e,n,t){"use strict";function r(e){switch(e){case i.ROW:case i.COLUMN:case i.SIZE:case i.SHAPE:return 6;default:return 10}}var i=e("./channel");t.autoMaxBins=r},{"./channel":47}],47:[function(e,n,t){"use strict";function r(e,n){return!!i(e)[n]}function i(e){switch(e){case t.X:case t.Y:case t.COLOR:case t.DETAIL:case t.ORDER:case t.OPACITY:case t.ROW:case t.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,line:!0,area:!0,text:!0};case t.X2:case t.Y2:return{rule:!0,bar:!0,area:!0};case t.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0};case t.SHAPE:return{point:!0};case t.TEXT:return{text:!0};case t.PATH:return{line:!0}}return{}}function o(e){switch(e){case t.X:case t.Y:case t.COLOR:case t.OPACITY:case t.LABEL:case t.DETAIL:return{measure:!0,dimension:!0};case t.ROW:case t.COLUMN:case t.SHAPE:return{measure:!1,dimension:!0};case t.X2:case t.Y2:case t.SIZE:case t.TEXT:return{measure:!0,dimension:!1};case t.PATH:return{measure:!1,dimension:!0}}throw new Error("Invalid encoding channel"+e)}function a(e){return!u.contains([t.DETAIL,t.PATH,t.TEXT,t.LABEL,t.ORDER],e)}var u=e("./util");!function(e){e[e.X="x"]="X",e[e.Y="y"]="Y",e[e.X2="x2"]="X2",e[e.Y2="y2"]="Y2",e[e.ROW="row"]="ROW",e[e.COLUMN="column"]="COLUMN",e[e.SHAPE="shape"]="SHAPE",e[e.SIZE="size"]="SIZE",e[e.COLOR="color"]="COLOR",e[e.TEXT="text"]="TEXT",e[e.DETAIL="detail"]="DETAIL",e[e.LABEL="label"]="LABEL",e[e.PATH="path"]="PATH",e[e.ORDER="order"]="ORDER",e[e.OPACITY="opacity"]="OPACITY"}(t.Channel||(t.Channel={}));var c=t.Channel;t.X=c.X,t.Y=c.Y,t.X2=c.X2,t.Y2=c.Y2,t.ROW=c.ROW,t.COLUMN=c.COLUMN,t.SHAPE=c.SHAPE,t.SIZE=c.SIZE,t.COLOR=c.COLOR,t.TEXT=c.TEXT,t.DETAIL=c.DETAIL,t.LABEL=c.LABEL,t.PATH=c.PATH,t.ORDER=c.ORDER,t.OPACITY=c.OPACITY,t.CHANNELS=[t.X,t.Y,t.X2,t.Y2,t.ROW,t.COLUMN,t.SIZE,t.SHAPE,t.COLOR,t.PATH,t.ORDER,t.OPACITY,t.TEXT,t.DETAIL,t.LABEL],t.UNIT_CHANNELS=u.without(t.CHANNELS,[t.ROW,t.COLUMN]),t.UNIT_SCALE_CHANNELS=u.without(t.UNIT_CHANNELS,[t.PATH,t.ORDER,t.DETAIL,t.TEXT,t.LABEL,t.X2,t.Y2]),t.NONSPATIAL_CHANNELS=u.without(t.UNIT_CHANNELS,[t.X,t.Y,t.X2,t.Y2]),t.NONSPATIAL_SCALE_CHANNELS=u.without(t.UNIT_SCALE_CHANNELS,[t.X,t.Y,t.X2,t.Y2]),
t.STACK_GROUP_CHANNELS=[t.COLOR,t.DETAIL,t.ORDER,t.OPACITY,t.SIZE],t.supportMark=r,t.getSupportedMark=i,t.getSupportedRole=o,t.hasScale=a},{"./util":56}],48:[function(e,n,t){"use strict";function r(e){return!!(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds)}function i(e){return c.isNumber(e)?e-1+"":(console.warn("Potentially invalid quarter",e),e)}function o(e){if(c.isNumber(e))return e-1+"";var n=e.toLowerCase(),r=t.MONTHS.indexOf(n);if(-1!==r)return r+"";var i=n.substr(0,3),o=t.SHORT_MONTHS.indexOf(i);return-1!==o?o+"":(console.warn("Potentially invalid month",e),e)}function a(e){if(c.isNumber(e))return e%7+"";var n=e.toLowerCase(),r=t.DAYS.indexOf(n);if(-1!==r)return r+"";var i=n.substr(0,3),o=t.SHORT_DAYS.indexOf(i);return-1!==o?o+"":(console.warn("Potentially invalid day",e),e)}function u(e,n){void 0===n&&(n=!1);var t=[];if(n&&void 0!==e.day)for(var r=0,u=["year","quarter","month","date"];r<u.length;r++){var s=u[r];if(void 0!==e[s]){console.warn("Dropping day from datetime",JSON.stringify(e),"as day cannot be combined with",s),e=c.duplicate(e),delete e.day;break}}if(void 0!==e.year?t.push(e.year):void 0!==e.day?t.push(2006):t.push(0),void 0!==e.month){var l=n?o(e.month):e.month;t.push(l)}else if(void 0!==e.quarter){var p=n?i(e.quarter):e.quarter;t.push(p+"*3")}else t.push(0);if(void 0!==e.date)t.push(e.date);else if(void 0!==e.day){var f=n?a(e.day):e.day;t.push(f+"+1")}else t.push(1);for(var E=0,d=["hours","minutes","seconds","milliseconds"];E<d.length;E++){var y=d[E];void 0!==e[y]?t.push(e[y]):t.push(0)}return"datetime("+t.join(", ")+")"}var c=e("./util");t.isDateTime=r,t.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],t.SHORT_MONTHS=t.MONTHS.map(function(e){return e.substr(0,3)}),t.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],t.SHORT_DAYS=t.DAYS.map(function(e){return e.substr(0,3)}),t.dateTimeExpr=u},{"./util":56}],49:[function(e,n,t){"use strict";function r(e){var n=0;return e.color&&n++,e.opacity&&n++,e.size&&n++,e.shape&&n++,n}function i(e){return y.CHANNELS.filter(function(n){return o(e,n)})}function o(e,n){var t=e&&e[n];return t&&(void 0!==t.field||h.isArray(t)&&t.length>0)}function a(e){return h.some(y.CHANNELS,function(n){return!(!o(e,n)||!e[n].aggregate)})}function u(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function c(e){var n=[];return y.CHANNELS.forEach(function(t){o(e,t)&&(h.isArray(e[t])?e[t].forEach(function(e){n.push(e)}):n.push(e[t]))}),n}function s(e,n,t){l(y.CHANNELS,e,n,t)}function l(e,n,t,r){var i=0;e.forEach(function(e){o(n,e)&&(h.isArray(n[e])?n[e].forEach(function(n){t.call(r,n,e,i++)}):t.call(r,n[e],e,i++))})}function p(e,n,t){return f(y.CHANNELS,e,n,t)}function f(e,n,t,r){var i=[];return e.forEach(function(e){o(n,e)&&(h.isArray(n[e])?n[e].forEach(function(n){i.push(t.call(r,n,e))}):i.push(t.call(r,n[e],e)))}),i}function E(e,n,t,r){return d(y.CHANNELS,e,n,t,r)}function d(e,n,t,r,i){var a=r;return y.CHANNELS.forEach(function(e){o(n,e)&&(h.isArray(n[e])?n[e].forEach(function(n){a=t.call(i,a,n,e)}):a=t.call(i,a,n[e],e))}),a}var y=e("./channel"),h=e("./util");t.countRetinal=r,t.channels=i,t.has=o,t.isAggregate=a,t.isRanged=u,t.fieldDefs=c,t.forEach=s,t.channelMappingForEach=l,t.map=p,t.channelMappingMap=f,t.reduce=E,t.channelMappingReduce=d},{"./channel":47,"./util":56}],50:[function(e,n,t){"use strict";!function(e){e[e.AREA="area"]="AREA",e[e.BAR="bar"]="BAR",e[e.LINE="line"]="LINE",e[e.POINT="point"]="POINT",e[e.TEXT="text"]="TEXT",e[e.TICK="tick"]="TICK",e[e.RULE="rule"]="RULE",e[e.CIRCLE="circle"]="CIRCLE",e[e.SQUARE="square"]="SQUARE",e[e.ERRORBAR="errorBar"]="ERRORBAR"}(t.Mark||(t.Mark={}));var r=t.Mark;t.AREA=r.AREA,t.BAR=r.BAR,t.LINE=r.LINE,t.POINT=r.POINT,t.TEXT=r.TEXT,t.TICK=r.TICK,t.RULE=r.RULE,t.CIRCLE=r.CIRCLE,t.SQUARE=r.SQUARE,t.ERRORBAR=r.ERRORBAR,t.PRIMITIVE_MARKS=[t.AREA,t.BAR,t.LINE,t.POINT,t.TEXT,t.TICK,t.RULE,t.CIRCLE,t.SQUARE]},{}],51:[function(e,n,t){"use strict";!function(e){e[e.LINEAR="linear"]="LINEAR",e[e.LOG="log"]="LOG",e[e.POW="pow"]="POW",e[e.SQRT="sqrt"]="SQRT",e[e.QUANTILE="quantile"]="QUANTILE",e[e.QUANTIZE="quantize"]="QUANTIZE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TIME="time"]="TIME",e[e.UTC="utc"]="UTC"}(t.ScaleType||(t.ScaleType={}));t.ScaleType;!function(e){e[e.SECOND="second"]="SECOND",e[e.MINUTE="minute"]="MINUTE",e[e.HOUR="hour"]="HOUR",e[e.DAY="day"]="DAY",e[e.WEEK="week"]="WEEK",e[e.MONTH="month"]="MONTH",e[e.YEAR="year"]="YEAR"}(t.NiceTime||(t.NiceTime={}));t.NiceTime;t.defaultScaleConfig={round:!0,textBandWidth:90,bandSize:21,padding:1,useRawDomain:!1,opacity:[.3,.8],nominalColorRange:"category10",sequentialColorRange:["#AFC6A3","#09622A"],shapeRange:"shapes",fontSizeRange:[8,40],ruleSizeRange:[1,5],tickSizeRange:[1,20]},t.defaultFacetScaleConfig={round:!0,padding:16}},{}],52:[function(e,n,t){"use strict";function r(e){return!!e&&!!e.field&&!!e.op}!function(e){e[e.ASCENDING="ascending"]="ASCENDING",e[e.DESCENDING="descending"]="DESCENDING",e[e.NONE="none"]="NONE"}(t.SortOrder||(t.SortOrder={}));t.SortOrder;t.isSortField=r},{}],53:[function(e,n,t){"use strict";function r(e,n,t){var r=t&&t.mark?t.mark.stacked:void 0;if(u.contains([c.NONE,null,!1],r))return null;if(!u.contains([a.BAR,a.AREA],e))return null;if(!o.isAggregate(n))return null;var s=i.STACK_GROUP_CHANNELS.reduce(function(e,t){return o.has(n,t)&&!n[t].aggregate&&e.push(t),e},[]);if(0===s.length)return null;var l=o.has(n,i.X),p=o.has(n,i.Y),f=l&&!!n.x.aggregate,E=p&&!!n.y.aggregate;return f!==E?{groupbyChannel:f?p?i.Y:null:l?i.X:null,fieldChannel:f?i.X:i.Y,stackByChannels:s,offset:r||c.ZERO}:null}var i=e("./channel"),o=e("./encoding"),a=e("./mark"),u=e("./util");!function(e){e[e.ZERO="zero"]="ZERO",e[e.CENTER="center"]="CENTER",e[e.NORMALIZE="normalize"]="NORMALIZE",e[e.NONE="none"]="NONE"}(t.StackOffset||(t.StackOffset={}));var c=t.StackOffset;t.stack=r},{"./channel":47,"./encoding":49,"./mark":50,"./util":56}],54:[function(e,n,t){"use strict";function r(e){return!!T[e]}function i(e,n){var r=new Date(0,0,1,0,0,0,0);return t.SINGLE_TIMEUNITS.forEach(function(t){if(a(e,t))switch(t){case h.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case h.YEAR:r.setFullYear(n.getFullYear());break;case h.QUARTER:r.setMonth(3*Math.floor(n.getMonth()/3));break;case h.MONTH:r.setMonth(n.getMonth());break;case h.DATE:r.setDate(n.getDate());break;case h.HOURS:r.setHours(n.getHours());break;case h.MINUTES:r.setMinutes(n.getMinutes());break;case h.SECONDS:r.setSeconds(n.getSeconds());break;case h.MILLISECONDS:r.setMilliseconds(n.getMilliseconds())}}),r}function o(e){return!!g[e]}function a(e,n){var t=e.toString(),r=n.toString(),i=t.indexOf(r);return i>-1&&(n!==h.SECONDS||0===i||"i"!==t.charAt(i-1))}function u(e){switch(e){case h.HOURS:case h.DAY:case h.MONTH:case h.QUARTER:return d.ScaleType.ORDINAL}return d.ScaleType.TIME}function c(e,n){function r(e){return e===h.QUARTER?"floor(month("+i+")/3)":e+"("+i+")"}var i="datum."+n,o=t.SINGLE_TIMEUNITS.reduce(function(n,t){return a(e,t)&&(n[t]=r(t)),n},{});return o.day&&y.keys(o).length>1&&(console.warn('Time unit "'+e+'" is not supported. We are replacing it with ',(e+"").replace("day","date")+"."),delete o.day,o.date=r(h.DATE)),E.dateTimeExpr(o)}function s(e,n){if(y.contains([f.ROW,f.COLUMN,f.SHAPE,f.COLOR],n))return null;switch(e){case h.SECONDS:return y.range(0,60);case h.MINUTES:return y.range(0,60);case h.HOURS:return y.range(0,24);case h.DAY:return y.range(0,7);case h.DATE:return y.range(1,32);case h.MONTH:return y.range(0,12);case h.QUARTER:return[0,3,6,9]}return null}function l(e){return e?a(e,h.SECONDS)?"second":a(e,h.MINUTES)?"minute":a(e,h.HOURS)?"hour":a(e,h.DAY)||a(e,h.DATE)?"day":a(e,h.MONTH)?"month":a(e,h.YEAR)?"year":void 0:void 0}function p(e,n,t){if(e){var r=[];a(e,h.YEAR)&&r.push(t?"%y":"%Y"),a(e,h.QUARTER)&&r.push("'}}Q{{"+n+" | quarter}}{{"+n+" | time:'"),a(e,h.MONTH)&&r.push(t?"%b":"%B"),a(e,h.DAY)?r.push(t?"%a":"%A"):a(e,h.DATE)&&r.push("%d");var i=[];a(e,h.HOURS)&&i.push("%H"),a(e,h.MINUTES)&&i.push("%M"),a(e,h.SECONDS)&&i.push("%S"),a(e,h.MILLISECONDS)&&i.push("%L");var o=[];if(r.length>0&&o.push(r.join("-")),i.length>0&&o.push(i.join(":")),o.length>0){var u="{{"+n+" | time:'"+o.join(" ")+"'}}";return u.replace(new RegExp("{{"+n+" \\| time:''}}","g"),"")}}}var f=e("./channel"),E=e("./datetime"),d=e("./scale"),y=e("./util");!function(e){e[e.YEAR="year"]="YEAR",e[e.MONTH="month"]="MONTH",e[e.DAY="day"]="DAY",e[e.DATE="date"]="DATE",e[e.HOURS="hours"]="HOURS",e[e.MINUTES="minutes"]="MINUTES",e[e.SECONDS="seconds"]="SECONDS",e[e.MILLISECONDS="milliseconds"]="MILLISECONDS",e[e.YEARMONTH="yearmonth"]="YEARMONTH",e[e.YEARMONTHDATE="yearmonthdate"]="YEARMONTHDATE",e[e.YEARMONTHDATEHOURS="yearmonthdatehours"]="YEARMONTHDATEHOURS",e[e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes"]="YEARMONTHDATEHOURSMINUTES",e[e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds"]="YEARMONTHDATEHOURSMINUTESSECONDS",e[e.HOURSMINUTES="hoursminutes"]="HOURSMINUTES",e[e.HOURSMINUTESSECONDS="hoursminutesseconds"]="HOURSMINUTESSECONDS",e[e.MINUTESSECONDS="minutesseconds"]="MINUTESSECONDS",e[e.SECONDSMILLISECONDS="secondsmilliseconds"]="SECONDSMILLISECONDS",e[e.QUARTER="quarter"]="QUARTER",e[e.YEARQUARTER="yearquarter"]="YEARQUARTER",e[e.QUARTERMONTH="quartermonth"]="QUARTERMONTH",e[e.YEARQUARTERMONTH="yearquartermonth"]="YEARQUARTERMONTH"}(t.TimeUnit||(t.TimeUnit={}));var h=t.TimeUnit;t.SINGLE_TIMEUNITS=[h.YEAR,h.QUARTER,h.MONTH,h.DAY,h.DATE,h.HOURS,h.MINUTES,h.SECONDS,h.MILLISECONDS];var T=t.SINGLE_TIMEUNITS.reduce(function(e,n){return e[n]=!0,e},{});t.isSingleTimeUnit=r,t.convert=i,t.MULTI_TIMEUNITS=[h.YEARQUARTER,h.YEARQUARTERMONTH,h.YEARMONTH,h.YEARMONTHDATE,h.YEARMONTHDATEHOURS,h.YEARMONTHDATEHOURSMINUTES,h.YEARMONTHDATEHOURSMINUTESSECONDS,h.QUARTERMONTH,h.HOURSMINUTES,h.HOURSMINUTESSECONDS,h.MINUTESSECONDS,h.SECONDSMILLISECONDS];var g=t.MULTI_TIMEUNITS.reduce(function(e,n){return e[n]=!0,e},{});t.isMultiTimeUnit=o,t.TIMEUNITS=t.SINGLE_TIMEUNITS.concat(t.MULTI_TIMEUNITS),t.containsTimeUnit=a,t.defaultScaleType=u,t.fieldExpr=c,t.rawDomain=s,t.smallestUnit=l,t.template=p},{"./channel":47,"./datetime":48,"./scale":51,"./util":56}],55:[function(e,n,t){"use strict";function r(e){var n=e;return t.TYPE_FROM_SHORT_TYPE[n.toUpperCase()]||n.toLowerCase()}!function(e){e[e.QUANTITATIVE="quantitative"]="QUANTITATIVE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TEMPORAL="temporal"]="TEMPORAL",e[e.NOMINAL="nominal"]="NOMINAL"}(t.Type||(t.Type={}));var i=t.Type;t.QUANTITATIVE=i.QUANTITATIVE,t.ORDINAL=i.ORDINAL,t.TEMPORAL=i.TEMPORAL,t.NOMINAL=i.NOMINAL,t.SHORT_TYPE={quantitative:"Q",temporal:"T",nominal:"N",ordinal:"O"},t.TYPE_FROM_SHORT_TYPE={Q:t.QUANTITATIVE,T:t.TEMPORAL,O:t.ORDINAL,N:t.NOMINAL},t.getFullName=r},{}],56:[function(e,n,t){"use strict";function r(e,n){var t={};return n.forEach(function(n){e.hasOwnProperty(n)&&(t[n]=e[n])}),t}function i(e,n){var t=O.duplicate(e);return n.forEach(function(e){delete t[e]}),t}function o(e){return I.isString(e)||I.isNumber(e)||I.isBoolean(e)?String(e):N(e)}function a(e,n){return e.indexOf(n)>-1}function u(e,n){return e.filter(function(e){return!a(n,e)})}function c(e,n){return e.concat(u(n,e))}function s(e,n,t){if(e.forEach)e.forEach.call(t,n);else for(var r in e)e.hasOwnProperty(r)&&n.call(t,e[r],r,e)}function l(e,n,t,r){if(e.reduce)return e.reduce.call(r,n,t);for(var i in e)e.hasOwnProperty(i)&&(t=n.call(r,t,e[i],i,e));return t}function p(e,n,t){if(e.map)return e.map.call(t,n);var r=[];for(var i in e)e.hasOwnProperty(i)&&r.push(n.call(t,e[i],i,e));return r}function f(e,n){for(var t=0,r=0;r<e.length;r++)if(n(e[r],r,t++))return!0;return!1}function E(e,n){for(var t=0,r=0;r<e.length;r++)if(!n(e[r],r,t++))return!1;return!0}function d(e){return[].concat.apply([],e)}function y(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];for(var r=0;r<n.length;r++)e=h(e,n[r]);return e}function h(e,n){if("object"!=typeof n||null===n)return e;for(var t in n)n.hasOwnProperty(t)&&void 0!==n[t]&&("object"!=typeof n[t]||null===n[t]?e[t]=n[t]:"object"!=typeof e[t]||null===e[t]?e[t]=y(n[t].constructor===Array?[]:{},n[t]):y(e[t],n[t]));return e}function T(e,n){return R({min:e.min,max:e.max,maxbins:n})}function g(e,n){var t,r,i,o=[],a={};for(r=0,i=e.length;i>r;++r)t=n?n(e[r]):e[r],t in a||(a[t]=1,o.push(e[r]));return o}function S(e){console.warn("[VL Warning]",e)}function m(e){console.error("[VL Error]",e)}function A(e,n){for(var t in e)if(e.hasOwnProperty(t)&&n[t]&&e[t]&&n[t]!==e[t])return!0;return!1}var N=e("json-stable-stringify"),v=e("datalib/src/util");t.keys=v.keys,t.extend=v.extend,t.duplicate=v.duplicate,t.isArray=v.isArray,t.vals=v.vals,t.truncate=v.truncate,t.toMap=v.toMap,t.isObject=v.isObject,t.isString=v.isString,t.isNumber=v.isNumber,t.isBoolean=v.isBoolean;var O=e("datalib/src/util"),C=e("datalib/src/generate");t.range=C.range;var I=e("datalib/src/util");t.pick=r,t.omit=i,t.hash=o,t.contains=a,t.without=u,t.union=c,t.forEach=s,t.reduce=l,t.map=p,t.some=f,t.every=E,t.flatten=d,t.mergeDeep=y;var R=e("datalib/src/bins/bins");t.getbins=T,t.unique=g,t.warning=S,t.error=m,t.differ=A},{"datalib/src/bins/bins":37,"datalib/src/generate":38,"datalib/src/util":40,"json-stable-stringify":41}]},{},[14])(14)});
//# sourceMappingURL=compassql.min.js.map
